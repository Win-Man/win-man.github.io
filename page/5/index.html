<!DOCTYPE html>
<html lang="">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Win-Man&#39;s Blog">
<meta property="og:url" content="http://yoursite.com/page/5/index.html">
<meta property="og:site_name" content="Win-Man&#39;s Blog">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Win-Man&#39;s Blog">

<link rel="canonical" href="http://yoursite.com/page/5/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'default'
  };
</script>

  <title>Win-Man's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Win-Man's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="default">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/29/《Docker从入门到实践》笔记思维导图/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/pig.jpeg">
      <meta itemprop="name" content="Win-Man">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Win-Man's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/01/29/《Docker从入门到实践》笔记思维导图/" class="post-title-link" itemprop="url">《Docker从入门到实践》笔记思维导图</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-01-29 11:08:13" itemprop="dateCreated datePublished" datetime="2018-01-29T11:08:13+00:00">2018-01-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-02-14 15:12:10" itemprop="dateModified" datetime="2022-02-14T15:12:10+00:00">2022-02-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Docker/" itemprop="url" rel="index"><span itemprop="name">Docker</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>最近在学习Docker，看了《Docker从入门到实践》这本书，做了一些笔记，在这边整理成思维导图的方式，分享一下。<br><img src="http://oc4wmeyj8.bkt.clouddn.com/Docker%E7%AC%94%E8%AE%B0%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BE.png" alt></p>
<blockquote>
<p>博客地址：<a href="https://win-man.github.io/" target="_blank" rel="noopener">https://win-man.github.io/</a><br>公众号：欢迎关注  </p>
</blockquote>
<p><img src="https://user-gold-cdn.xitu.io/2018/8/16/165435ce71d2b88b?w=258&amp;h=258&amp;f=jpeg&amp;s=26568" alt></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="default">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/15/MariaDB Galera集群搭建/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/pig.jpeg">
      <meta itemprop="name" content="Win-Man">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Win-Man's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/01/15/MariaDB Galera集群搭建/" class="post-title-link" itemprop="url">MariaDB Galera集群搭建</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-01-15 11:08:13" itemprop="dateCreated datePublished" datetime="2018-01-15T11:08:13+00:00">2018-01-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-02-14 15:12:10" itemprop="dateModified" datetime="2022-02-14T15:12:10+00:00">2022-02-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MariaDB/" itemprop="url" rel="index"><span itemprop="name">MariaDB</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1、概述"><a href="#1、概述" class="headerlink" title="1、概述"></a>1、概述</h1><h2 id="1-1、目的"><a href="#1-1、目的" class="headerlink" title="1.1、目的"></a>1.1、目的</h2><h2 id="1-2、环境信息"><a href="#1-2、环境信息" class="headerlink" title="1.2、环境信息"></a>1.2、环境信息</h2><ul>
<li>操作系统版本CentOS Linux release 7.2.1511 (Core)</li>
<li>MariaDB:10.1.14-MariaDB MariaDB Server</li>
<li>物理机1：node1：10.10.90.167</li>
<li>物理机2：node2：10.10.90.174</li>
<li>物理机3：node3：10.10.90.181</li>
</ul>
<h1 id="2、Galera集群搭建步骤"><a href="#2、Galera集群搭建步骤" class="headerlink" title="2、Galera集群搭建步骤"></a>2、Galera集群搭建步骤</h1><h2 id="2-1、MariaDB安装步骤"><a href="#2-1、MariaDB安装步骤" class="headerlink" title="2.1、MariaDB安装步骤"></a>2.1、MariaDB安装步骤</h2><h3 id="MariaDB参数"><a href="#MariaDB参数" class="headerlink" title="MariaDB参数"></a>MariaDB参数</h3><p>MariaDB-10.1.14安装步骤与MySQL-5.6一致，只是一些在MySQL中的参数，在MarIaDB中不能使用或者被忽略。在QData的参数模板中，以下参数会导致数据库初始化话<strong>失败</strong>：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">gtid-mode=on # GTID only</span><br><span class="line">enforce-gtid-consistency=true # GTID only</span><br><span class="line">slave_parallel_type=LOGICAL_CLOCK</span><br><span class="line">innodb_undo_log_truncate=ON</span><br><span class="line">log_timestamps=SYSTEM</span><br><span class="line">slave_preserve_commit_order=ON</span><br></pre></td></tr></table></figure></p>
<p>以下参数会使数据库初始化的过程中出现警告:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">slave_pending_jobs_size_max=128M</span><br><span class="line">table_open_cache = 4096</span><br><span class="line">binlog-rows-query-log-events</span><br><span class="line">master-info-repository</span><br><span class="line">relay-log-info-repository</span><br><span class="line">slave-parallel-workers</span><br></pre></td></tr></table></figure></p>
<p>使用的参数模板如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br></pre></td><td class="code"><pre><span class="line">[client]</span><br><span class="line">loose_default-character-set = utf8</span><br><span class="line">port=3306</span><br><span class="line">socket=/home/mysql/data/mysqldata1/sock/mysql.sock</span><br><span class="line">user=admin</span><br><span class="line"></span><br><span class="line">[mysqldump]</span><br><span class="line">quick</span><br><span class="line">max_allowed_packet = 2G</span><br><span class="line">default-character-set = utf8</span><br><span class="line"></span><br><span class="line">[mysql]</span><br><span class="line">no-auto-rehash</span><br><span class="line">show-warnings</span><br><span class="line">prompt=&quot;\\u@\\h : \\d \\r:\\m:\\s&gt; &quot;</span><br><span class="line">default-character-set = utf8</span><br><span class="line"></span><br><span class="line">[myisamchk]</span><br><span class="line">key_buffer = 512M</span><br><span class="line">sort_buffer_size = 512M</span><br><span class="line">read_buffer = 8M</span><br><span class="line">write_buffer = 8M</span><br><span class="line"></span><br><span class="line">[mysqlhotcopy]</span><br><span class="line">interactive-timeout</span><br><span class="line"></span><br><span class="line">[mysqld_safe]</span><br><span class="line">user=mysql</span><br><span class="line">open-files-limit = 65535</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line">#large-pages</span><br><span class="line">#***********************************common parameters******************************</span><br><span class="line">read_only=on</span><br><span class="line">#memlock</span><br><span class="line">default-storage-engine = INNODB</span><br><span class="line">character-set-server=utf8</span><br><span class="line">collation_server = utf8_bin</span><br><span class="line"></span><br><span class="line">user=mysql</span><br><span class="line">port=3306</span><br><span class="line">socket=/home/mysql/data/mysqldata1/sock/mysql.sock</span><br><span class="line">pid-file=/home/mysql/data/mysqldata1/sock/mysql.pid</span><br><span class="line">datadir=/home/mysql/data/mysqldata1/mydata</span><br><span class="line">tmpdir=/home/mysql/data/mysqldata1/tmpdir</span><br><span class="line"></span><br><span class="line">skip-name-resolve</span><br><span class="line">skip_external_locking</span><br><span class="line"></span><br><span class="line">lower_case_table_names=1</span><br><span class="line">event_scheduler=0</span><br><span class="line">back_log=512</span><br><span class="line">default-time-zone=&apos;+8:00&apos;</span><br><span class="line"></span><br><span class="line">max_connections = 3000</span><br><span class="line">max_connect_errors=99999</span><br><span class="line">max_allowed_packet = 64M</span><br><span class="line">#slave_pending_jobs_size_max=128M</span><br><span class="line">max_heap_table_size = 8M</span><br><span class="line">max_length_for_sort_data = 16k</span><br><span class="line"></span><br><span class="line">wait_timeout=172800</span><br><span class="line">interactive_timeout=172800</span><br><span class="line"></span><br><span class="line">net_buffer_length = 8K</span><br><span class="line">read_buffer_size = 2M</span><br><span class="line">read_rnd_buffer_size = 2M</span><br><span class="line">sort_buffer_size = 2M</span><br><span class="line">join_buffer_size = 4M</span><br><span class="line">binlog_cache_size = 2M</span><br><span class="line"></span><br><span class="line">#table_open_cache = 4096</span><br><span class="line">table_open_cache_instances = 2</span><br><span class="line">table_definition_cache = 4096</span><br><span class="line">thread_cache_size = 512</span><br><span class="line">tmp_table_size = 8M</span><br><span class="line"></span><br><span class="line">query_cache_size=0</span><br><span class="line">query_cache_type=OFF</span><br><span class="line">explicit_defaults_for_timestamp=ON</span><br><span class="line"></span><br><span class="line">#*******************************  Logs related settings ***************************</span><br><span class="line">log-error=/home/mysql/data/mysqldata1/log/error.log</span><br><span class="line">long_query_time = 1</span><br><span class="line">slow_query_log</span><br><span class="line">slow_query_log_file=/home/mysql/data/mysqldata1/slowlog/slow-query.log</span><br><span class="line">log_slow_slave_statements</span><br><span class="line">#log_queries_not_using_indexes</span><br><span class="line"></span><br><span class="line">#*******************************  Replication related settings **********************</span><br><span class="line"></span><br><span class="line">#### For Master</span><br><span class="line">server-id=3306191</span><br><span class="line">log-bin=/home/mysql/data/mysqldata1/binlog/mysql-bin</span><br><span class="line">binlog-format=ROW</span><br><span class="line">binlog-checksum=CRC32</span><br><span class="line">#binlog-rows-query-log-events=1</span><br><span class="line">max_binlog_size = 512M</span><br><span class="line">expire_logs_days=15</span><br><span class="line">sync_binlog=1</span><br><span class="line">master-verify-checksum=1</span><br><span class="line">#master-info-repository=TABLE</span><br><span class="line">auto_increment_increment=2</span><br><span class="line">auto_increment_offset=2</span><br><span class="line"></span><br><span class="line">#### For Slave</span><br><span class="line">relay-log=/home/mysql/data/mysqldata1/relaylog/mysql-relay-bin</span><br><span class="line">#relay-log-info-repository=TABLE</span><br><span class="line">relay-log-recovery=1</span><br><span class="line">#slave-skip-errors=1022,1032,1062,1236</span><br><span class="line">slave-sql-verify-checksum=1</span><br><span class="line">log_bin_trust_function_creators=1</span><br><span class="line">log_slave_updates=1</span><br><span class="line">slave-net-timeout=10</span><br><span class="line">skip-slave-start</span><br><span class="line"></span><br><span class="line">#******************************* MyISAM Specific options ****************************</span><br><span class="line">key_buffer_size = 8M</span><br><span class="line">bulk_insert_buffer_size = 8M</span><br><span class="line">myisam_sort_buffer_size = 64M</span><br><span class="line">myisam_max_sort_file_size = 10G</span><br><span class="line">myisam_repair_threads = 1</span><br><span class="line">myisam_recover_options=force</span><br><span class="line"></span><br><span class="line"># ***************************** INNODB Specific options ****************************</span><br><span class="line">#### Data options</span><br><span class="line">#innodb_data_home_dir = /home/mysql/data/mysqldata1/innodb_ts</span><br><span class="line">innodb_data_file_path = ibdata1:2048M:autoextend</span><br><span class="line">innodb_file_per_table</span><br><span class="line">innodb_file_format = barracuda</span><br><span class="line">innodb_file_format_max = barracuda</span><br><span class="line">innodb_file_format_check = ON</span><br><span class="line">innodb_strict_mode = 1</span><br><span class="line">innodb_flush_method = O_DIRECT</span><br><span class="line">innodb_checksum_algorithm=crc32</span><br><span class="line">innodb_autoinc_lock_mode=2</span><br><span class="line"></span><br><span class="line">#### Buffer Pool options</span><br><span class="line">innodb_buffer_pool_size = 4G</span><br><span class="line">innodb_buffer_pool_instances = 2</span><br><span class="line">innodb_max_dirty_pages_pct = 75</span><br><span class="line">innodb_adaptive_flushing = ON</span><br><span class="line">innodb_flush_neighbors = 0</span><br><span class="line">innodb_lru_scan_depth = 4096</span><br><span class="line">#innodb_change_buffering = inserts</span><br><span class="line">innodb_old_blocks_time = 1000</span><br><span class="line"></span><br><span class="line">#### Redo options</span><br><span class="line">innodb_log_group_home_dir = /home/mysql/data/mysqldata1/innodb_log</span><br><span class="line">innodb_log_buffer_size = 64M</span><br><span class="line">innodb_log_file_size = 2G</span><br><span class="line">innodb_log_files_in_group = 2</span><br><span class="line">innodb_flush_log_at_trx_commit = 1</span><br><span class="line">innodb_fast_shutdown = 2</span><br><span class="line">innodb_support_xa = ON</span><br><span class="line"></span><br><span class="line">#### Transaction options</span><br><span class="line">innodb_thread_concurrency = 64</span><br><span class="line">innodb_lock_wait_timeout = 120</span><br><span class="line">innodb_rollback_on_timeout = 1</span><br><span class="line">transaction_isolation = READ-COMMITTED</span><br><span class="line"></span><br><span class="line">#### IO options</span><br><span class="line">innodb_read_io_threads = 8</span><br><span class="line">innodb_write_io_threads = 16</span><br><span class="line">innodb_io_capacity = 20000</span><br><span class="line">innodb_use_native_aio = 1</span><br><span class="line"></span><br><span class="line">#### Undo options</span><br><span class="line">innodb_undo_directory = /home/mysql/data/mysqldata1/undo/</span><br><span class="line">innodb_undo_tablespaces=16</span><br><span class="line">innodb_purge_threads = 4</span><br><span class="line">innodb_purge_batch_size = 512</span><br><span class="line">innodb_max_purge_lag = 65536</span><br><span class="line"></span><br><span class="line">#### 5.6/5.7 GTID</span><br><span class="line">#gtid-mode=on # GTID only</span><br><span class="line">#enforce-gtid-consistency=true # GTID only</span><br><span class="line"></span><br><span class="line">#### mysql 5.7</span><br><span class="line">#super_read_only=on</span><br><span class="line">secure_file_priv=/data2/</span><br><span class="line">#slave_parallel_workers=16</span><br><span class="line">#slave_parallel_type=LOGICAL_CLOCK</span><br><span class="line">#innodb_undo_log_truncate=ON</span><br><span class="line">#log_timestamps=SYSTEM</span><br><span class="line">#slave_preserve_commit_order=ON</span><br><span class="line"></span><br><span class="line">#### mariadb</span><br><span class="line">gtid_strict_mode=on</span><br><span class="line">gtid_domain_id=191</span><br><span class="line"></span><br><span class="line">#### galera</span><br><span class="line">wsrep_on=on</span><br><span class="line">wsrep_provider=/usr/local/mysql/lib/galera/libgalera_smm.so</span><br><span class="line">wsrep_provider_options=&quot;gcache.size=1G&quot;</span><br><span class="line"></span><br><span class="line">wsrep_cluster_name=wqglr_0001</span><br><span class="line">wsrep_cluster_address=gcomm://10.10.90.167:4567,10.10.90.174:4567,10.10.90.181:4567</span><br><span class="line">wsrep_node_name = node3</span><br><span class="line">wsrep_node_address=10.10.90.181:4567</span><br><span class="line">#</span><br><span class="line">#wsrep_sst_method=xtrabackup-v2</span><br><span class="line">#wsrep_sst_auth=&quot;xtrabackup:xtrabackuppass&quot;</span><br><span class="line">#wsrep_slave_threads=16</span><br><span class="line">#</span><br><span class="line">#innodb_support_xa = OFF</span><br><span class="line">#sync_binlog=0</span><br><span class="line">#innodb_flush_log_at_trx_commit = 0</span><br></pre></td></tr></table></figure></p>
<h3 id="安装步骤"><a href="#安装步骤" class="headerlink" title="安装步骤"></a>安装步骤</h3><ul>
<li><p>创建目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /data2/mysqldata1/&#123;binlog,conf,innodb_log,innodb_ts,log,mydata,relaylog,slowlog,sock,tmpdir,undo&#125;</span><br><span class="line">mkdir -p /home/mysql/&#123;data,program&#125;</span><br><span class="line">ln -s /data2/mysqldata1 /home/mysql/data/mysqldata1</span><br></pre></td></tr></table></figure>
</li>
<li><p>下载二进制安装包，并上传到对应位置</p>
</li>
<li><p>将安装包解压至指定目录,并建立软链至/usr/local</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf mariadb-10.1.14-linux-x86_64 -c /home/mysql/program/</span><br><span class="line">ln -s /home/mysql/program/mariadb-10.1.14-linux-x86_64 /usr/local/mysql</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加用户以及用户组</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">groupadd mysql</span><br><span class="line">useradd -r -g mysql mysql</span><br></pre></td></tr></table></figure>
</li>
<li><p>更改目录权限</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chown -R mysql:mysql /data/mysqldata1</span><br></pre></td></tr></table></figure>
</li>
<li><p>填写配置文件<br>将上面的配置文件内容写到/etc/my.cnf中</p>
</li>
<li>初始化数据库<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/mysql</span><br><span class="line">./scripts/mysql_install_db --defaults-file=/etc/my.cnf --user=mysql</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>验证安装成功：</strong><br>查看是否有两个OK</p>
<ul>
<li><p>添加service启动方式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/local/mysql/support-files/mysql.server /etc/init.d/mysqld</span><br></pre></td></tr></table></figure>
</li>
<li><p>尝试启动数据库，验证数据库正常</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service mysqld start</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong> 按照相同的步骤安装三个节点</strong></p>
<h2 id="2-2、Galera集群安装步骤"><a href="#2-2、Galera集群安装步骤" class="headerlink" title="2.2、Galera集群安装步骤"></a>2.2、Galera集群安装步骤</h2><h3 id="2-2-1、第一个节点安装"><a href="#2-2-1、第一个节点安装" class="headerlink" title="2.2.1、第一个节点安装"></a>2.2.1、第一个节点安装</h3><p>安装步骤:</p>
<ul>
<li><p>在配置文件中填写galera集群的配置参数<br>一下为最基础的参数配置，一些调优等的配置参数不列在这边</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">gtid_strict_mode=on</span><br><span class="line">gtid_domain_id=191</span><br><span class="line">wsrep_on=on</span><br><span class="line">wsrep_provider=/usr/local/mysql/lib/galera/libgalera_smm.so</span><br><span class="line">wsrep_provider_options=&quot;gcache.size=1G&quot;</span><br><span class="line">wsrep_cluster_name=wqglr_0001</span><br><span class="line">wsrep_cluster_address=gcomm://10.10.90.167:4567,10.10.90.174:4567,10.10.90.181:4567</span><br><span class="line">wsrep_node_name = node3</span><br><span class="line">wsrep_node_address=10.10.90.181:4567</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动第一个节点<br>galera集群启动第一个节点的时候需要加上，–wsrep-new-cluster来初始化一个集群，这个只需要在<strong>第一个节点第一次启动</strong>的时候添加，之后该节点启动时不需要添加该参数，因为这个参数的表示初始化一个新的集群，每次添加该参数，都会初始化一个新的集群</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/mysql/bin</span><br><span class="line">./mysqld_safe --defaults-file=/etc/my.cnf --wsrep-new-cluster &amp;</span><br></pre></td></tr></table></figure>
</li>
<li><p>进入数据库检查，集群状态 show status like ‘%wsrep_%’</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">root@localhost : (none) 11:00:08&gt; show status like &apos;%wsrep_%&apos;;</span><br><span class="line">+------------------------------+----------------------------------------------------------------+</span><br><span class="line">| Variable_name                | Value                                                          |</span><br><span class="line">+------------------------------+----------------------------------------------------------------+</span><br><span class="line">| wsrep_apply_oooe            | 0.000000                                                      |</span><br><span class="line">| wsrep_apply_oool            | 0.000000                                                      |</span><br><span class="line">| wsrep_apply_window          | 1.000000                                                      |</span><br><span class="line">| wsrep_causal_reads          | 0                                                              |</span><br><span class="line">| wsrep_cert_deps_distance    | 1.000000                                                      |</span><br><span class="line">| wsrep_cert_index_size        | 1                                                              |</span><br><span class="line">| wsrep_cert_interval          | 0.000000                                                      |</span><br><span class="line">| wsrep_cluster_conf_id        | 10                                                            |</span><br><span class="line">| wsrep_cluster_size          | 3                                                              |</span><br><span class="line">| wsrep_cluster_state_uuid    | 5ace7bde-f5d3-11e7-81fd-b7f62639a9a0                          |</span><br><span class="line">| wsrep_cluster_status        | Primary                                                        |</span><br><span class="line">| wsrep_commit_oooe            | 0.000000                                                      |</span><br><span class="line">| wsrep_commit_oool            | 0.000000                                                      |</span><br><span class="line">| wsrep_commit_window          | 1.000000                                                      |</span><br><span class="line">| wsrep_connected              | ON                                                            |</span><br><span class="line">| wsrep_evs_delayed            | 829f35c1-f5d6-11e7-9525-b21c1d0f3f09:tcp://10.10.90.191:4567:1 |</span><br><span class="line">| wsrep_evs_evict_list        |                                                                |</span><br><span class="line">| wsrep_evs_repl_latency      | 0/0/0/0/0                                                      |</span><br><span class="line">| wsrep_evs_state              | OPERATIONAL                                                    |</span><br><span class="line">| wsrep_flow_control_paused    | 0.000000                                                      |</span><br><span class="line">| wsrep_flow_control_paused_ns | 0                                                              |</span><br><span class="line">| wsrep_flow_control_recv      | 0                                                              |</span><br><span class="line">| wsrep_flow_control_sent      | 0                                                              |</span><br><span class="line">| wsrep_gcomm_uuid            | 5acdf3cc-f5d3-11e7-bcb5-46c7c07b299e                          |</span><br><span class="line">| wsrep_incoming_addresses    | 10.10.90.181:3306,10.10.90.167:3306,10.10.90.174:3306          |</span><br><span class="line">| wsrep_last_committed        | 3                                                              |</span><br><span class="line">| wsrep_local_bf_aborts        | 0                                                              |</span><br><span class="line">| wsrep_local_cached_downto    | 1                                                              |</span><br><span class="line">| wsrep_local_cert_failures    | 0                                                              |</span><br><span class="line">| wsrep_local_commits          | 0                                                              |</span><br><span class="line">| wsrep_local_index            | 1                                                              |</span><br><span class="line">| wsrep_local_recv_queue      | 0                                                              |</span><br><span class="line">| wsrep_local_recv_queue_avg  | 0.074074                                                      |</span><br><span class="line">| wsrep_local_recv_queue_max  | 2                                                              |</span><br><span class="line">| wsrep_local_recv_queue_min  | 0                                                              |</span><br><span class="line">| wsrep_local_replays          | 0                                                              |</span><br><span class="line">| wsrep_local_send_queue      | 0                                                              |</span><br><span class="line">| wsrep_local_send_queue_avg  | 0.000000                                                      |</span><br><span class="line">| wsrep_local_send_queue_max  | 1                                                              |</span><br><span class="line">| wsrep_local_send_queue_min  | 0                                                              |</span><br><span class="line">| wsrep_local_state            | 4                                                              |</span><br><span class="line">| wsrep_local_state_comment    | Synced                                                        |</span><br><span class="line">| wsrep_local_state_uuid      | 5ace7bde-f5d3-11e7-81fd-b7f62639a9a0                          |</span><br><span class="line">| wsrep_protocol_version      | 7                                                              |</span><br><span class="line">| wsrep_provider_name          | Galera                                                        |</span><br><span class="line">| wsrep_provider_vendor        | Codership Oy &lt;info@codership.com&gt;                              |</span><br><span class="line">| wsrep_provider_version      | 25.3.15(r3578)                                                |</span><br><span class="line">| wsrep_ready                  | ON                                                            |</span><br><span class="line">| wsrep_received              | 27                                                            |</span><br><span class="line">| wsrep_received_bytes        | 3661                                                          |</span><br><span class="line">| wsrep_repl_data_bytes        | 356                                                            |</span><br><span class="line">| wsrep_repl_keys              | 1                                                              |</span><br><span class="line">| wsrep_repl_keys_bytes        | 31                                                            |</span><br><span class="line">| wsrep_repl_other_bytes      | 0                                                              |</span><br><span class="line">| wsrep_replicated            | 1                                                              |</span><br><span class="line">| wsrep_replicated_bytes      | 451                                                            |</span><br><span class="line">| wsrep_thread_count          | 2                                                              |</span><br><span class="line">+------------------------------+----------------------------------------------------------------+</span><br><span class="line">57 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>重点关注几个状态:<br><code>wsrep_connected=on</code> 表示链接已开启<br><code>wsrep_local_index=1</code> 表示集群中的索引值<br><code>wsrep_cluster_size=3</code> 表示集群中节点的数量<br><code>wsrep_incoming_addresses =0.10.90.181:3306,10.10.90.167:3306,10.10.90.174:3306</code>集群中节点的访问地址</p>
<h3 id="2-2-2、加入一个数据节点"><a href="#2-2-2、加入一个数据节点" class="headerlink" title="2.2.2、加入一个数据节点"></a>2.2.2、加入一个数据节点</h3><p>安装步骤</p>
<ul>
<li><p>在配置文件中填写galera集群的配置参数<br>一下为最基础的参数配置，一些调优等的配置参数不列在这边</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">gtid_strict_mode=on</span><br><span class="line">gtid_domain_id=191</span><br><span class="line">wsrep_on=on</span><br><span class="line">wsrep_provider=/usr/local/mysql/lib/galera/libgalera_smm.so</span><br><span class="line">wsrep_provider_options=&quot;gcache.size=1G&quot;</span><br><span class="line">wsrep_cluster_name=wqglr_0001</span><br><span class="line">wsrep_cluster_address=gcomm://10.10.90.167:4567,10.10.90.174:4567,10.10.90.181:4567</span><br><span class="line">wsrep_node_name = node3</span><br><span class="line">wsrep_node_address=10.10.90.181:4567</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动节点</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service mysqld start</span><br></pre></td></tr></table></figure>
</li>
<li><p>进入数据库检查，集群状态 show status like ‘%wsrep_%’</p>
</li>
</ul>
<h3 id="2-2-3、加入一个仲裁节点"><a href="#2-2-3、加入一个仲裁节点" class="headerlink" title="2.2.3、加入一个仲裁节点"></a>2.2.3、加入一个仲裁节点</h3><p>仲裁节点不需要初始化数据库，不需要进行配置，但是数据目录需要创建，数据库程序需要部署</p>
<ul>
<li><p>启动仲裁节点</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/mysql/bin</span><br><span class="line">./garbd --address=&quot;gcomm://10.10.90.167:4567,10.10.90.174:4567,10.10.90.181:4567&quot; --group=wqglr_0001 --name=&apos;10.10.90.181:4567&apos; --log=/home/mysql/data/mysqldata1/log/garbd.log -d</span><br></pre></td></tr></table></figure>
</li>
<li><p>检查仲裁节点加入情况<br>node1或者node2上show status like ‘%wsrep_cluster%’;查看集群节点数量，发现集群节点数量增加1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@localhost : (none) 01:23:30&gt; show status like &apos;%wsrep_cluster%&apos;;</span><br><span class="line">+--------------------------+--------------------------------------+</span><br><span class="line">| Variable_name            | Value                                |</span><br><span class="line">+--------------------------+--------------------------------------+</span><br><span class="line">| wsrep_cluster_conf_id    | 3                                    |</span><br><span class="line">| wsrep_cluster_size      | 3                                    |</span><br><span class="line">| wsrep_cluster_state_uuid | 75b1d970-f681-11e7-a221-af292503fa6e |</span><br><span class="line">| wsrep_cluster_status    | Primary                              |</span><br><span class="line">+--------------------------+--------------------------------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="2-2-4、验证数据同步"><a href="#2-2-4、验证数据同步" class="headerlink" title="2.2.4、验证数据同步"></a>2.2.4、验证数据同步</h3><p>在node1上：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create database test1;</span><br><span class="line">use test1;</span><br><span class="line">create table test1(id int primary key auto_increment,name varchar(20));</span><br><span class="line">insert  into test1(`name`) values(&apos;test1&apos;);</span><br></pre></td></tr></table></figure></p>
<p>在node2上<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create database test2;</span><br><span class="line">use test2;</span><br><span class="line">create table test1(id int primary key auto_increment,name varchar(20));</span><br><span class="line">insert  into test1(`name`) values(&apos;test1&apos;);</span><br></pre></td></tr></table></figure></p>
<p>在两个节点上查询数据，发现数据复制正常</p>
<h3 id="2-2-5、脑裂验证"><a href="#2-2-5、脑裂验证" class="headerlink" title="2.2.5、脑裂验证"></a>2.2.5、脑裂验证</h3><h1 id="3、安装过程中的问题"><a href="#3、安装过程中的问题" class="headerlink" title="3、安装过程中的问题"></a>3、安装过程中的问题</h1><h2 id="galera集群启动过程中，报libssl和libcrypto库缺失"><a href="#galera集群启动过程中，报libssl和libcrypto库缺失" class="headerlink" title="galera集群启动过程中，报libssl和libcrypto库缺失"></a>galera集群启动过程中，报libssl和libcrypto库缺失</h2><p>错误日志：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">2018-01-09 16:19:28 140122035881856 [Warning] &apos;table-open-cache-instances&apos; is MySQL 5.6 compatible option. Not used or needed in MariaDB.</span><br><span class="line">2018-01-09 16:19:28 140122035881856 [Note] /usr/local/mysql/bin/mysqld (mysqld 10.1.14-MariaDB) starting as process 31625 ...</span><br><span class="line">2018-01-09 16:19:28 140122035881856 [Note] WSREP: Read nil XID from storage engines, skipping position init</span><br><span class="line">2018-01-09 16:19:28 140122035881856 [Note] WSREP: wsrep_load(): loading provider library &apos;/usr/local/mysql/lib/galera/libgalera_smm.so&apos;</span><br><span class="line">2018-01-09 16:19:28 140122035881856 [ERROR] WSREP: wsrep_load(): dlopen(): libssl.so.6: cannot open shared object file: No such file or directory</span><br><span class="line">2018-01-09 16:19:28 140122035881856 [ERROR] WSREP: wsrep_load(/usr/local/mysql/lib/galera/libgalera_smm.so) failed: Invalid argument (22). Reverting to no provider.</span><br><span class="line">2018-01-09 16:19:28 140122035881856 [Note] WSREP: Read nil XID from storage engines, skipping position init</span><br><span class="line">2018-01-09 16:19:28 140122035881856 [Note] WSREP: wsrep_load(): loading provider library &apos;none&apos;</span><br><span class="line">2018-01-09 16:19:28 140122035881856 [ERROR] Aborting</span><br></pre></td></tr></table></figure></p>
<p>解决方案：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">#ldd libgalera_smm.so</span><br><span class="line">        linux-vdso.so.1 =&gt;  (0x00007ffda1bdc000)</span><br><span class="line">        libpthread.so.0 =&gt; /lib64/libpthread.so.0 (0x00007fabbb35f000)</span><br><span class="line">        librt.so.1 =&gt; /lib64/librt.so.1 (0x00007fabbb157000)</span><br><span class="line">        libssl.so.6 =&gt; not found</span><br><span class="line">        libcrypto.so.6 =&gt; not found</span><br><span class="line">        libstdc++.so.6 =&gt; /lib64/libstdc++.so.6 (0x00007fabbae4e000)</span><br><span class="line">        libm.so.6 =&gt; /lib64/libm.so.6 (0x00007fabbab4b000)</span><br><span class="line">        libgcc_s.so.1 =&gt; /lib64/libgcc_s.so.1 (0x00007fabba935000)</span><br><span class="line">        libc.so.6 =&gt; /lib64/libc.so.6 (0x00007fabba574000)</span><br><span class="line">        /lib64/ld-linux-x86-64.so.2 (0x00007fabbbade000)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@node2 /lib64]</span><br><span class="line">#cd /usr/lib64</span><br><span class="line"></span><br><span class="line">[root@node2 /usr/lib64]</span><br><span class="line">#ll libssl*</span><br><span class="line">-rwxr-xr-x. 1 root 272536 Nov 20  2015 libssl3.so</span><br><span class="line">lrwxrwxrwx. 1 root    16 Dec 27 15:31 libssl.so -&gt; libssl.so.1.0.1e</span><br><span class="line">lrwxrwxrwx. 1 root    16 Dec 27 15:30 libssl.so.10 -&gt; libssl.so.1.0.1e</span><br><span class="line">-rwxr-xr-x. 1 root 449864 Jun 29  2015 libssl.so.1.0.1e</span><br><span class="line"></span><br><span class="line">[root@node2 /usr/lib64]</span><br><span class="line">#ln -s libssl.so.1.0.1e libssl.so.6</span><br><span class="line"></span><br><span class="line">[root@node2 /usr/lib64]</span><br><span class="line">#ll libcrypto*</span><br><span class="line">lrwxrwxrwx. 1 root      19 Dec 27 15:31 libcrypto.so -&gt; libcrypto.so.1.0.1e</span><br><span class="line">lrwxrwxrwx. 1 root      19 Dec 27 15:30 libcrypto.so.10 -&gt; libcrypto.so.1.0.1e</span><br><span class="line">-rwxr-xr-x. 1 root 2012880 Jun 29  2015 libcrypto.so.1.0.1e</span><br><span class="line"></span><br><span class="line">[root@node2 /usr/lib64]</span><br><span class="line">#ln -s libcrypto.so.1.0.1e libcrypto.so.6</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#ldd /usr/local/mysql/lib/galera/libgalera_smm.so</span><br><span class="line">        linux-vdso.so.1 =&gt;  (0x00007ffecdbad000)</span><br><span class="line">        libpthread.so.0 =&gt; /lib64/libpthread.so.0 (0x00007fe44169e000)</span><br><span class="line">        librt.so.1 =&gt; /lib64/librt.so.1 (0x00007fe441496000)</span><br><span class="line">        libssl.so.6 =&gt; /lib64/libssl.so.6 (0x00007fe441228000)</span><br><span class="line">        libcrypto.so.6 =&gt; /lib64/libcrypto.so.6 (0x00007fe440e41000)</span><br><span class="line">        libstdc++.so.6 =&gt; /lib64/libstdc++.so.6 (0x00007fe440b39000)</span><br><span class="line">        libm.so.6 =&gt; /lib64/libm.so.6 (0x00007fe440836000)</span><br><span class="line">        libgcc_s.so.1 =&gt; /lib64/libgcc_s.so.1 (0x00007fe440620000)</span><br><span class="line">        libc.so.6 =&gt; /lib64/libc.so.6 (0x00007fe44025f000)</span><br><span class="line">        /lib64/ld-linux-x86-64.so.2 (0x00007fe441e1d000)</span><br><span class="line">        libgssapi_krb5.so.2 =&gt; /lib64/libgssapi_krb5.so.2 (0x00007fe440012000)</span><br><span class="line">        libkrb5.so.3 =&gt; /lib64/libkrb5.so.3 (0x00007fe43fd2d000)</span><br><span class="line">        libcom_err.so.2 =&gt; /lib64/libcom_err.so.2 (0x00007fe43fb29000)</span><br><span class="line">        libk5crypto.so.3 =&gt; /lib64/libk5crypto.so.3 (0x00007fe43f8f6000)</span><br><span class="line">        libdl.so.2 =&gt; /lib64/libdl.so.2 (0x00007fe43f6f2000)</span><br><span class="line">        libz.so.1 =&gt; /lib64/libz.so.1 (0x00007fe43f4dc000)</span><br><span class="line">        libkrb5support.so.0 =&gt; /lib64/libkrb5support.so.0 (0x00007fe43f2cc000)</span><br><span class="line">        libkeyutils.so.1 =&gt; /lib64/libkeyutils.so.1 (0x00007fe43f0c8000)</span><br><span class="line">        libresolv.so.2 =&gt; /lib64/libresolv.so.2 (0x00007fe43eeae000)</span><br><span class="line">        libselinux.so.1 =&gt; /lib64/libselinux.so.1 (0x00007fe43ec88000)</span><br><span class="line">        libpcre.so.1 =&gt; /lib64/libpcre.so.1 (0x00007fe43ea27000)</span><br><span class="line">        liblzma.so.5 =&gt; /lib64/liblzma.so.5 (0x00007fe43e802000)</span><br></pre></td></tr></table></figure></p>
<h2 id="配置的innodb-data-home-dir和innodb-log-home-dir，导致rsync模式的sst传输报错"><a href="#配置的innodb-data-home-dir和innodb-log-home-dir，导致rsync模式的sst传输报错" class="headerlink" title="配置的innodb_data_home_dir和innodb_log_home_dir，导致rsync模式的sst传输报错"></a>配置的innodb_data_home_dir和innodb_log_home_dir，导致rsync模式的sst传输报错</h2><p>因为我们的galera集群的配置参数中没有指定：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#wsrep_sst_method=xtrabackup-v2</span><br><span class="line">#wsrep_sst_auth=&quot;xtrabackup:xtrabackuppass&quot;</span><br></pre></td></tr></table></figure></p>
<p>所以galeta集群在进行sst的时候是通过默认的的rsync方式同步的，但是在这种方式下，不能自定义innodb_data_home_dir和innodb_log_home_dir,这是MariaDB Galera的BUG，如果要自定义这两个参数，可以选择xtrabackup的方式。<br>wsrep_sst_method可以指定为mysqldump,xtrabackup,rsync三种，xtrabackup的方式锁表时间最短</p>
<blockquote>
<p>博客地址：<a href="https://win-man.github.io/" target="_blank" rel="noopener">https://win-man.github.io/</a><br>公众号：欢迎关注  </p>
</blockquote>
<p><img src="https://user-gold-cdn.xitu.io/2018/8/16/165435ce71d2b88b?w=258&amp;h=258&amp;f=jpeg&amp;s=26568" alt></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="default">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/19/MySQL——触发器、存储过程、函数、定时器认识/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/pig.jpeg">
      <meta itemprop="name" content="Win-Man">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Win-Man's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/09/19/MySQL——触发器、存储过程、函数、定时器认识/" class="post-title-link" itemprop="url">MySQL——触发器、存储过程、函数、定时器认识</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-09-19 12:08:13" itemprop="dateCreated datePublished" datetime="2017-09-19T12:08:13+00:00">2017-09-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-02-14 15:12:10" itemprop="dateModified" datetime="2022-02-14T15:12:10+00:00">2022-02-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>博客地址：<a href="https://win-man.github.io/" target="_blank" rel="noopener">https://win-man.github.io/</a><br>公众号：欢迎关注  </p>
</blockquote>
<p><img src="https://user-gold-cdn.xitu.io/2018/8/16/165435ce71d2b88b?w=258&amp;h=258&amp;f=jpeg&amp;s=26568" alt></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="default">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/25/NFS总结/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/pig.jpeg">
      <meta itemprop="name" content="Win-Man">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Win-Man's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/08/25/NFS总结/" class="post-title-link" itemprop="url">NFS总结</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-08-25 16:13:04" itemprop="dateCreated datePublished" datetime="2017-08-25T16:13:04+00:00">2017-08-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-02-14 15:12:10" itemprop="dateModified" datetime="2022-02-14T15:12:10+00:00">2022-02-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="什么是NFS，为什么要NFS"><a href="#什么是NFS，为什么要NFS" class="headerlink" title="什么是NFS，为什么要NFS"></a>什么是NFS，为什么要NFS</h2><p>NFS（Network File System）这个网络文件系统，最大的功能是通过网络，使得在不同的机器之间共享文件。通过NFS可以将另一台机器的某个目录挂载到本机的某个目录下，在使用的时候挂载过来的目录就像在本地一样。极大的方便了多台服务器之间的文件共享。</p>
<h2 id="什么是RPC"><a href="#什么是RPC" class="headerlink" title="什么是RPC"></a>什么是RPC</h2><p>在提到NFS服务的时候，都会提到RPC服务，那么什么是RPC服务，为什么需要RPC服务呢。<br>首先RPC是Remote Procedure Call的缩写，及远程过程调用。其次关于为什么要RPC服务是因为，NFS服务在启动的时候对于端口的选择是随机的，NFS在启动的时候回随机选择小于1024的端口进行数据的传输。那么在客户端连接到NFS服务器的时候，怎么知道应该通过哪个端口进行连接呢。这个时候就需要RPC服务出现了，RPC的主要功能就是记录每个NFS服务所对应的端口号，并将对应的端口号发送给客户端，客户端根据获得的端口号进行连接。<br><strong>客户端连接NFS服务的过程：</strong></p>
<ol>
<li>客户端首先向NFS服务所在的服务器的RPC服务发起请求，RPC服务的端口固定为111</li>
<li>RPC服务在接收到客户端的请求之后，找到注册的NFS服务所对应的端口号，并将端口号发送给客户端</li>
<li>客户端根据获取到NFS端口号进行连接</li>
</ol>
<h2 id="配置NFS步骤"><a href="#配置NFS步骤" class="headerlink" title="配置NFS步骤"></a>配置NFS步骤</h2><ul>
<li>环境介绍<ul>
<li>CentOS6.6</li>
</ul>
</li>
</ul>
<h3 id="NFS主要软件结构"><a href="#NFS主要软件结构" class="headerlink" title="NFS主要软件结构"></a>NFS主要软件结构</h3><ul>
<li>/etc/exports NFS的主要配置文件，在该文件中定义NFS输出的目录、权限等属性</li>
<li>/usr/sbin/exportfs 管理NFS共享资源的命令，在NFS的server端使用</li>
<li>/usr/sbin/showmount 查询NFS共享资源的命令，在client端使用</li>
<li>/var/lib/nfs/etab NFS的日志文件，记录了NFS共享出来的目录的完整权限设置值</li>
<li>/var/lib/nfs/xtab NFS连接信息的日志文件，记录了曾经链接到此NFS服务器的相关客户端的数据</li>
</ul>
<h3 id="etc-exports配置文件介绍"><a href="#etc-exports配置文件介绍" class="headerlink" title="/etc/exports配置文件介绍"></a>/etc/exports配置文件介绍</h3><p>配置文件中的格式：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;输出目录&gt; [客户端1(权限)] [客户端2(权限)] ...</span><br></pre></td></tr></table></figure></p>
<ul>
<li><p>输出目录<br>指定共享的文件目录</p>
</li>
<li><p>客户端<br>指定可以访问共享资源的客户端</p>
<ul>
<li>指定IP的方式：192.168.1.1</li>
<li>指定网段的方式 192.168.1.0/24或者192.168.1.0/255.255.255.0</li>
<li>指定主机名的方式 node1，但是这个主机名必须在记录在/etc/hosts文件内，需要能解析到对应的ip</li>
<li>通配符的方式 <em>表示所有的主机，node</em>主机名通配</li>
</ul>
</li>
<li><p>权限</p>
<ul>
<li>rw/ro 指定文件是可读写（read-write）的还是只读（read-only）的</li>
<li>sync/async 对目录中的数据进行更改的话，更改会同步写到硬盘还是只写到内存直接写到硬盘</li>
<li>no_root_squash 当客户端使用root账户连接的时候，不转化为匿名用户</li>
<li>root_squash 当客户端使用root账户连接的会后，转化为匿名用户</li>
<li>all_squash 当客户端连接的时候，无论使用什么用户进行连接，都会被转换为匿名用户</li>
<li>anonuid 指定匿名用户的UID</li>
<li>anongid 指定匿名用户的GID</li>
</ul>
</li>
</ul>
<h3 id="NFS-server端配置"><a href="#NFS-server端配置" class="headerlink" title="NFS server端配置"></a>NFS server端配置</h3><ul>
<li><p>检查服务器是否安装了nfs-util和rpcbind两个包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@d146bbc8-94a2-42c4-8eaa-3fb3264fd176 ~]# rpm -qa | grep nfs</span><br><span class="line">nfs-utils-1.2.3-54.el6.x86_64</span><br><span class="line">nfs-utils-lib-1.1.5-9.el6.x86_64</span><br><span class="line">[root@d146bbc8-94a2-42c4-8eaa-3fb3264fd176 ~]# rpm -qa | grep rpcbind</span><br><span class="line">rpcbind-0.2.0-11.el6.x86_64</span><br></pre></td></tr></table></figure>
</li>
<li><p>填写/etc/exports配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /nfs/&#123;test1,test2,test3,test4,test5&#125;</span><br><span class="line">vim /etc/exports</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="http://oc4wmeyj8.bkt.clouddn.com/nfs.png" alt><br>exports配置文件中都有默认权限配置，如果我们想查看默认的配置是什么，可以查看<code>/var/lib/nfs/etab</code>文件，该文件中完整的记录了NFS共享资源的所有配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/nfs/test2	10.10.30.247(rw,sync,wdelay,hide,nocrossmnt,secure,root_squash,no_all_squash,no_subtree_check,secure_locks,acl,anonuid=65534,anongid=65534)</span><br><span class="line">/nfs/test1	10.10.30.247(rw,sync,wdelay,hide,nocrossmnt,secure,root_squash,no_all_squash,no_subtree_check,secure_locks,acl,anonuid=65534,anongid=65534)</span><br><span class="line">/nfs/test3	10.10.30.0/24(rw,sync,wdelay,hide,nocrossmnt,secure,root_squash,no_all_squash,no_subtree_check,secure_locks,acl,anonuid=65534,anongid=65534)</span><br><span class="line">/nfs/test2	*(ro,sync,wdelay,hide,nocrossmnt,secure,root_squash,no_all_squash,no_subtree_check,secure_locks,acl,anonuid=65534,anongid=65534)</span><br></pre></td></tr></table></figure></p>
<ul>
<li><p>启动RPC服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@d146bbc8-94a2-42c4-8eaa-3fb3264fd176 ~]# /etc/init.d/rpcbind start</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动NFS服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@d146bbc8-94a2-42c4-8eaa-3fb3264fd176 ~]# /etc/init.d/nfs start</span><br><span class="line">Starting NFS services:                                     [  OK  ]</span><br><span class="line">Starting NFS quotas:                                       [  OK  ]</span><br><span class="line">Starting NFS mountd:                                       [  OK  ]</span><br><span class="line">Starting NFS daemon:                                       [  OK  ]</span><br><span class="line">Starting RPC idmapd:                                       [  OK  ]</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改/etc/exports文件<br>如果我们在启动NFS服务之后，又修改了 <code>exports</code> 文件的话怎么办，是不是需要重新启动NFS服务才能使的这些配置生效，答案当然是否定的，这样多麻烦。我们有 <code>exportfs</code> 命令。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">exportfs [-aruv]</span><br><span class="line"></span><br><span class="line">options:</span><br><span class="line"> -a:全部挂载或卸载</span><br><span class="line"> -r:重新挂载/etc/exports配置文件中的信息</span><br><span class="line"> -u:卸载某一目录</span><br><span class="line"> -v:将内容显示输出</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="client端配置"><a href="#client端配置" class="headerlink" title="client端配置"></a>client端配置</h3><ul>
<li>通过showmount命令查看NFS共享资源的情况<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@6a192e7f-a43d-4b57-9573-ca740e3b5f0d ~]# showmount -e 10.10.30.250</span><br><span class="line">Export list for 10.10.30.250:</span><br><span class="line">/nfs/test3 10.10.30.0/24</span><br><span class="line">/nfs/test2 (everyone)</span><br><span class="line">/nfs/test1 10.10.30.247</span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">showmount [-ae] [hostname|IP]</span><br><span class="line"></span><br><span class="line">options:</span><br><span class="line"> -a:显示当前主机与客户端的NFS连接情况</span><br><span class="line"> -e:显示指定NFS服务器的共享资源情况</span><br></pre></td></tr></table></figure>
<ul>
<li><p>挂载NFS目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@6a192e7f-a43d-4b57-9573-ca740e3b5f0d ~]# mkdir -p /nfs/local/&#123;test1,test2,test3&#125;</span><br><span class="line">[root@6a192e7f-a43d-4b57-9573-ca740e3b5f0d ~]# mount 10.10.30.250:/nfs/test1 /nfs/local/test1</span><br><span class="line">[root@6a192e7f-a43d-4b57-9573-ca740e3b5f0d ~]# mount 10.10.30.250:/nfs/test2 /nfs/local/test2</span><br><span class="line">[root@6a192e7f-a43d-4b57-9573-ca740e3b5f0d ~]# mount 10.10.30.250:/nfs/test3 /nfs/local/test3</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看挂载情况</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@6a192e7f-a43d-4b57-9573-ca740e3b5f0d ~]# df -h</span><br><span class="line">Filesystem            Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/mapper/VolGroup-root</span><br><span class="line">                       50G  5.3G   42G  12% /</span><br><span class="line">tmpfs                 1.9G     0  1.9G   0% /dev/shm</span><br><span class="line">/dev/vda1             488M   31M  432M   7% /boot</span><br><span class="line">/dev/sda               20G   33M   20G   1% /data</span><br><span class="line">10.10.30.250:/nfs/test1</span><br><span class="line">                       50G  5.3G   42G  12% /nfs/local/test1</span><br><span class="line">10.10.30.250:/nfs/test2</span><br><span class="line">                       50G  5.3G   42G  12% /nfs/local/test2</span><br><span class="line">10.10.30.250:/nfs/test3</span><br><span class="line">                       50G  5.3G   42G  12% /nfs/local/test3</span><br><span class="line">[root@6a192e7f-a43d-4b57-9573-ca740e3b5f0d ~]# mount</span><br><span class="line">/dev/mapper/VolGroup-root on / type ext4 (rw)</span><br><span class="line">proc on /proc type proc (rw)</span><br><span class="line">sysfs on /sys type sysfs (rw)</span><br><span class="line">devpts on /dev/pts type devpts (rw,gid=5,mode=620)</span><br><span class="line">tmpfs on /dev/shm type tmpfs (rw)</span><br><span class="line">/dev/vda1 on /boot type ext4 (rw)</span><br><span class="line">none on /proc/sys/fs/binfmt_misc type binfmt_misc (rw)</span><br><span class="line">/dev/sda on /data type xfs (rw,nouuid)</span><br><span class="line">sunrpc on /var/lib/nfs/rpc_pipefs type rpc_pipefs (rw)</span><br><span class="line">10.10.30.250:/nfs/test1 on /nfs/local/test1 type nfs (rw,vers=4,addr=10.10.30.250,clientaddr=10.10.30.247)</span><br><span class="line">10.10.30.250:/nfs/test2 on /nfs/local/test2 type nfs (rw,vers=4,addr=10.10.30.250,clientaddr=10.10.30.247)</span><br><span class="line">10.10.30.250:/nfs/test3 on /nfs/local/test3 type nfs (rw,vers=4,addr=10.10.30.250,clientaddr=10.10.30.247)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="NFS文件访问权限设置"><a href="#NFS文件访问权限设置" class="headerlink" title="NFS文件访问权限设置"></a>NFS文件访问权限设置</h2><p>我们知道在Linux系统中的文件，都有访问权限，可以指定用户访问，那么我通过NFS访问文件权限是如何设定的呢。比如我再NFS server上有一个文件的属主与属组都是gangshen,那我再client端普通用户user1访问这个文件，可以做修改吗？如果是使用root用户访问这个文件，可以做修改吗？<br>NFS文件系统的权限访问的原则是：<strong>服务器端会以客户端的用户UID与GID等身份来尝试读取服务器端的文件系统</strong><br>以下是NFS是如何判断是否一个文件可写的步骤:</p>
<ol>
<li>客户端以user1这个账户访问NFS目录，实际是以client端的user1的UID以及GID进行访问的</li>
<li>NFS server收到客户端访问请求中的UID、GID，并根据这个UID在server端所在的服务器找到相应的用户，以该用户的权限进行访问</li>
<li>如果找不到对应UID的用户，则NFS server端会将连接的身份转换为匿名用户的连接</li>
<li>根据/etc/exports配置文件判断该目录是否有写入权限<br>只有在满足：1、用户有写入权限 2、exports设置为有写入权限 3、文件具有写入权限 这三点之后，客户端才可以写入NFS是共享目录。</li>
</ol>
<p>根据上述步骤的话，可以想到一种情况，如果我client端是通过root账户连接的，那我是不是对所有的文件具有可读、可写权限。这个的话，就需要重新来看下/etc/exports这个配置文件了。在exports文件中，设定权限的时候可以指定no_root_squash、root_squash、all_squash，这三个就是控制，我client连接上来的用户，最终在server端会以哪个用户进行访问。默认情况下是设置为root_squash，就是说如果client以root用户连接上来的话，server端会将该用户转换为匿名用户进行访问。很明显no_root_squash这个选项就是说不转换成匿名用户，all_squash这个选项是指定无论client用什么账户连接上来，都会被转换成匿名用户。</p>
<blockquote>
<p>博客地址：<a href="https://win-man.github.io/" target="_blank" rel="noopener">https://win-man.github.io/</a><br>公众号：欢迎关注  </p>
</blockquote>
<p><img src="https://user-gold-cdn.xitu.io/2018/8/16/165435ce71d2b88b?w=258&amp;h=258&amp;f=jpeg&amp;s=26568" alt></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="default">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/07/11/在Linux下磁盘分区、创建文件系统、挂载/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/pig.jpeg">
      <meta itemprop="name" content="Win-Man">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Win-Man's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/07/11/在Linux下磁盘分区、创建文件系统、挂载/" class="post-title-link" itemprop="url">在Linux下磁盘分区、创建文件系统、挂载</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-07-11 14:52:22" itemprop="dateCreated datePublished" datetime="2017-07-11T14:52:22+00:00">2017-07-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-02-14 15:12:10" itemprop="dateModified" datetime="2022-02-14T15:12:10+00:00">2022-02-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>学习Linux的时候，避不开的就是需要学习Linux中的分区。学习Linux的分区，有很多概念性的东西需要学习，比如分区类型啊，文件系统类型啊…等等，对于我来说，并不是很喜欢这种概念性的东西，上来一大段文字对于我一点都不友好。所以整理了一篇笔记，记录怎么对Linux中的磁盘进行分区、创建文件系统以及挂载。首先能实操使用，接着再慢慢理解其中的内容。</p>
<h3 id="环境介绍"><a href="#环境介绍" class="headerlink" title="环境介绍"></a>环境介绍</h3><p>操作系统：CentOS6.6</p>
<h2 id="命令介绍"><a href="#命令介绍" class="headerlink" title="命令介绍"></a>命令介绍</h2><h3 id="分区命令"><a href="#分区命令" class="headerlink" title="分区命令"></a>分区命令</h3><h4 id="fdisk-分区"><a href="#fdisk-分区" class="headerlink" title="fdisk 分区"></a>fdisk 分区</h4><p>fdisk可用于查看硬盘分区情况，也可以使用fdisk进行分区。<br><strong>选项：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-b SECTOR_SIZE：指定每个分区大小</span><br><span class="line">-l:列出指定硬盘的分区情况</span><br><span class="line">-s PARTITION:输出指定分区的大小，单位为块</span><br><span class="line">-u:在列出硬盘分区情况的时候，使用块为单位列出分区大小而不是以柱面为单位</span><br><span class="line">-v:显示版本信息</span><br></pre></td></tr></table></figure></p>
<p><strong>子选项：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">p:print，显示已有分区</span><br><span class="line">n:new，创建</span><br><span class="line">d:delete，删除</span><br><span class="line">w:write，写入磁盘并退出</span><br><span class="line">q:quit，放弃更新并退出</span><br><span class="line">m:获取帮助</span><br><span class="line">l:列表所分区id</span><br><span class="line">t:调整分区id</span><br></pre></td></tr></table></figure></p>
<h4 id="partx-识别分区"><a href="#partx-识别分区" class="headerlink" title="partx 识别分区"></a>partx 识别分区</h4><p><em>**选项：</em><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-a:通知内核重新读取硬盘分区表</span><br><span class="line">-d:删除分区硬盘分区表信息</span><br><span class="line">-l:列出分区</span><br><span class="line">--type YTPE:指定分区类型</span><br><span class="line">--nr M-N:指定分区范围</span><br></pre></td></tr></table></figure></p>
<h3 id="创建文件系统命令"><a href="#创建文件系统命令" class="headerlink" title="创建文件系统命令"></a>创建文件系统命令</h3><h4 id="mkfs-创建文件系统"><a href="#mkfs-创建文件系统" class="headerlink" title="mkfs 创建文件系统"></a>mkfs 创建文件系统</h4><p><strong>选项：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-t TYPE:指定穿件的文件系统类型</span><br><span class="line">-v:显示版本信息</span><br><span class="line">-c:创建文件系统之前，先检查分区是否存在坏块</span><br></pre></td></tr></table></figure></p>
<h4 id="mkswap-创建交换分区"><a href="#mkswap-创建交换分区" class="headerlink" title="mkswap 创建交换分区"></a>mkswap 创建交换分区</h4><p><strong>选项：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-c:创建交换分区之前，先检查分区是否存在坏块</span><br><span class="line">-f:强制执行</span><br></pre></td></tr></table></figure></p>
<h3 id="挂载命令"><a href="#挂载命令" class="headerlink" title="挂载命令"></a>挂载命令</h3><h4 id="mount-挂载分区"><a href="#mount-挂载分区" class="headerlink" title="mount 挂载分区"></a>mount 挂载分区</h4><p>mount [-fnrsvw] [-t vfstype] [-o options] device dir<br><strong>选项：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">-t vsftype:指定要挂载的设备上的文件系统类型</span><br><span class="line">-r ：readonly，只读挂载</span><br><span class="line">-w：read and write，读写挂载</span><br><span class="line">-n：不更新/etc/fstab</span><br><span class="line">-a：自动挂载所有支持自动挂载的设备（定义在了/etc/fstab文件中，且挂载选项中有“自动挂载”功能）</span><br><span class="line">-L &apos;LABEL&apos;：以卷标指定挂载设备</span><br><span class="line">-U &apos;UUID&apos;：以UUID指定要挂载的设备</span><br><span class="line">-B，--bind：绑定目录到另一个目录上</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-o options:挂载文件系统的选项</span><br><span class="line">async：异步模式</span><br><span class="line">sync：同步模式</span><br><span class="line">atime/noatime:包含目录和文件</span><br><span class="line">diratime/nodiratime:目录的访问时间戳</span><br><span class="line">auto/noauto:是否支持自动挂载</span><br><span class="line">exec/noexec:是否支持将文件系统上的应用程序运行为进程</span><br><span class="line">dev/nodev:是否支持在此文件系统上使用设备</span><br><span class="line">suid/nosuid；</span><br><span class="line">remount：重新挂载</span><br><span class="line">ro：只读挂载</span><br><span class="line">rw：读写挂载</span><br><span class="line">user/nouser:是否允许普通用户挂载此设备</span><br><span class="line">acl：启用此文件系统上acl功能</span><br><span class="line">defaults：rw,suid,dev,exec,auto,nouser,and async</span><br></pre></td></tr></table></figure></p>
<h4 id="umount-卸载分区"><a href="#umount-卸载分区" class="headerlink" title="umount 卸载分区"></a>umount 卸载分区</h4><p>umount [-dflnrv] {dir|device}…<br><strong>选项：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-a：卸除/etc/mtab中记录的所有文件系统；</span><br><span class="line">-h：显示帮助；</span><br><span class="line">-n：卸除时不要将信息存入/etc/mtab文件中；</span><br><span class="line">-r：若无法成功卸除，则尝试以只读的方式重新挂入文件系统；</span><br><span class="line">-t&lt;文件系统类型&gt;：仅卸除选项中所指定的文件系统；</span><br><span class="line">-v：执行时显示详细的信息；</span><br><span class="line">-V：显示版本信息。</span><br></pre></td></tr></table></figure></p>
<h4 id="swapon-启用交换分区"><a href="#swapon-启用交换分区" class="headerlink" title="swapon 启用交换分区"></a>swapon 启用交换分区</h4><p>swapon [-f] [-p priority] [-v] specialfile…<br><strong>选项：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-a ：激活所有的交换分区</span><br><span class="line">-p PRIORITY：指定优先级</span><br></pre></td></tr></table></figure></p>
<h4 id="swapoff-禁用交换分区"><a href="#swapoff-禁用交换分区" class="headerlink" title="swapoff 禁用交换分区"></a>swapoff 禁用交换分区</h4><p>swapoff [-v] specialfile…<br><strong>选项：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-a：禁用所有的交换分区</span><br></pre></td></tr></table></figure></p>
<h2 id="步骤介绍"><a href="#步骤介绍" class="headerlink" title="步骤介绍"></a>步骤介绍</h2><h3 id="普通分区从创建以及挂载"><a href="#普通分区从创建以及挂载" class="headerlink" title="普通分区从创建以及挂载"></a>普通分区从创建以及挂载</h3><ul>
<li><p>查看硬盘以及分区情况</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@sg-pc /]# lsblk</span><br><span class="line">NAME                       MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sr0                         11:0    1  4.3G  0 rom  </span><br><span class="line">sda                          8:0    0   20G  0 disk </span><br><span class="line">├─sda1                       8:1    0  500M  0 part /boot</span><br><span class="line">└─sda2                       8:2    0 19.5G  0 part </span><br><span class="line">  ├─vg_sgpc-lv_root (dm-0) 253:0    0 17.6G  0 lvm  /</span><br><span class="line">  └─vg_sgpc-lv_swap (dm-1) 253:1    0    2G  0 lvm  [SWAP]</span><br><span class="line">sdb                          8:16   0   20G  0 disk </span><br><span class="line">[root@sg-pc /]# fdisk /dev/sdb</span><br><span class="line"></span><br><span class="line">WARNING: DOS-compatible mode is deprecated. It&apos;s strongly recommended to</span><br><span class="line">         switch off the mode (command &apos;c&apos;) and change display units to</span><br><span class="line">         sectors (command &apos;u&apos;).</span><br><span class="line"></span><br><span class="line">Command (m for help): p</span><br><span class="line"></span><br><span class="line">Disk /dev/sdb: 21.5 GB, 21474836480 bytes</span><br><span class="line">255 heads, 63 sectors/track, 2610 cylinders</span><br><span class="line">Units = cylinders of 16065 * 512 = 8225280 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk identifier: 0x179a39d6</span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line"></span><br><span class="line">Command (m for help):</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用fdisk对/dev/sdb硬盘划分分区，划分3个主分区，每个主分区5G大小，并且划分一个扩展分区，4G大小。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">[root@sg-pc /]# fdisk /dev/sdb</span><br><span class="line"></span><br><span class="line">WARNING: DOS-compatible mode is deprecated. It&apos;s strongly recommended to</span><br><span class="line">         switch off the mode (command &apos;c&apos;) and change display units to</span><br><span class="line">         sectors (command &apos;u&apos;).</span><br><span class="line"></span><br><span class="line">Command (m for help): n</span><br><span class="line">Command action</span><br><span class="line">   e   extended</span><br><span class="line">   p   primary partition (1-4)</span><br><span class="line">p</span><br><span class="line">Partition number (1-4): 1</span><br><span class="line">First cylinder (1-2610, default 1): </span><br><span class="line">Using default value 1</span><br><span class="line">Last cylinder, +cylinders or +size&#123;K,M,G&#125; (1-2610, default 2610): +5G</span><br><span class="line"></span><br><span class="line">Command (m for help): n</span><br><span class="line">Command action</span><br><span class="line">   e   extended</span><br><span class="line">   p   primary partition (1-4)</span><br><span class="line">p</span><br><span class="line">Partition number (1-4): 2</span><br><span class="line">First cylinder (655-2610, default 655): </span><br><span class="line">Using default value 655</span><br><span class="line">Last cylinder, +cylinders or +size&#123;K,M,G&#125; (655-2610, default 2610): +5G</span><br><span class="line"></span><br><span class="line">Command (m for help): n</span><br><span class="line">Command action</span><br><span class="line">   e   extended</span><br><span class="line">   p   primary partition (1-4)</span><br><span class="line">p</span><br><span class="line">Partition number (1-4): 3</span><br><span class="line">First cylinder (1309-2610, default 1309): </span><br><span class="line">Using default value 1309</span><br><span class="line">Last cylinder, +cylinders or +size&#123;K,M,G&#125; (1309-2610, default 2610): +5G</span><br><span class="line"></span><br><span class="line">Command (m for help): n</span><br><span class="line">Command action</span><br><span class="line">   e   extended</span><br><span class="line">   p   primary partition (1-4)</span><br><span class="line">e</span><br><span class="line">Selected partition 4</span><br><span class="line">First cylinder (1963-2610, default 1963): </span><br><span class="line">Using default value 1963</span><br><span class="line">Last cylinder, +cylinders or +size&#123;K,M,G&#125; (1963-2610, default 2610): +2610</span><br><span class="line">Value out of range.</span><br><span class="line">Last cylinder, +cylinders or +size&#123;K,M,G&#125; (1963-2610, default 2610): </span><br><span class="line">Using default value 2610</span><br><span class="line"></span><br><span class="line">Command (m for help): p</span><br><span class="line"></span><br><span class="line">Disk /dev/sdb: 21.5 GB, 21474836480 bytes</span><br><span class="line">255 heads, 63 sectors/track, 2610 cylinders</span><br><span class="line">Units = cylinders of 16065 * 512 = 8225280 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk identifier: 0x179a39d6</span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sdb1               1         654     5253223+  83  Linux</span><br><span class="line">/dev/sdb2             655        1308     5253255   83  Linux</span><br><span class="line">/dev/sdb3            1309        1962     5253255   83  Linux</span><br><span class="line">/dev/sdb4            1963        2610     5205060    5  Extended</span><br><span class="line"></span><br><span class="line">Command (m for help): n</span><br><span class="line">First cylinder (1963-2610, default 1963): </span><br><span class="line">Using default value 1963</span><br><span class="line">Last cylinder, +cylinders or +size&#123;K,M,G&#125; (1963-2610, default 2610): +2G </span><br><span class="line"></span><br><span class="line">Command (m for help): p</span><br><span class="line"></span><br><span class="line">Disk /dev/sdb: 21.5 GB, 21474836480 bytes</span><br><span class="line">255 heads, 63 sectors/track, 2610 cylinders</span><br><span class="line">Units = cylinders of 16065 * 512 = 8225280 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk identifier: 0x179a39d6</span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sdb1               1         654     5253223+  83  Linux</span><br><span class="line">/dev/sdb2             655        1308     5253255   83  Linux</span><br><span class="line">/dev/sdb3            1309        1962     5253255   83  Linux</span><br><span class="line">/dev/sdb4            1963        2610     5205060    5  Extended</span><br><span class="line">/dev/sdb5            1963        2224     2104483+  83  Linux</span><br><span class="line"></span><br><span class="line">Command (m for help): w</span><br><span class="line">The partition table has been altered!</span><br><span class="line"></span><br><span class="line">Calling ioctl() to re-read partition table.</span><br><span class="line">Syncing disks.</span><br></pre></td></tr></table></figure>
</li>
<li><p>将新划分的分区加载到硬盘分区表中，并查看分区状态</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@sg-pc /]# partx -a /dev/sdb</span><br><span class="line">BLKPG: Device or resource busy</span><br><span class="line">error adding partition 1</span><br><span class="line">BLKPG: Device or resource busy</span><br><span class="line">error adding partition 2</span><br><span class="line">BLKPG: Device or resource busy</span><br><span class="line">error adding partition 3</span><br><span class="line">BLKPG: Device or resource busy</span><br><span class="line">error adding partition 4</span><br><span class="line">BLKPG: Device or resource busy</span><br><span class="line">error adding partition 5</span><br><span class="line">[root@sg-pc /]# cat /proc/partitions </span><br><span class="line">major minor  #blocks  name</span><br><span class="line"></span><br><span class="line">   8        0   20971520 sda</span><br><span class="line">   8        1     512000 sda1</span><br><span class="line">   8        2   20458496 sda2</span><br><span class="line">   8       16   20971520 sdb</span><br><span class="line">   8       17    5253223 sdb1</span><br><span class="line">   8       18    5253255 sdb2</span><br><span class="line">   8       19    5253255 sdb3</span><br><span class="line">   8       20          1 sdb4</span><br><span class="line">   8       21    2104483 sdb5</span><br><span class="line"> 253        0   18391040 dm-0</span><br><span class="line"> 253        1    2064384 dm-1</span><br></pre></td></tr></table></figure>
</li>
<li><p>为分区创建文件系统，这边就选择/dev/sdb1分区作为示例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@sg-pc /]# mkfs -t ext4 -L &apos;backup&apos; /dev/sdb1</span><br><span class="line">mke2fs 1.41.12 (17-May-2010)</span><br><span class="line">Filesystem label=backup</span><br><span class="line">OS type: Linux</span><br><span class="line">Block size=4096 (log=2)</span><br><span class="line">Fragment size=4096 (log=2)</span><br><span class="line">Stride=0 blocks, Stripe width=0 blocks</span><br><span class="line">328656 inodes, 1313305 blocks</span><br><span class="line">65665 blocks (5.00%) reserved for the super user</span><br><span class="line">First data block=0</span><br><span class="line">Maximum filesystem blocks=1346371584</span><br><span class="line">41 block groups</span><br><span class="line">32768 blocks per group, 32768 fragments per group</span><br><span class="line">8016 inodes per group</span><br><span class="line">Superblock backups stored on blocks: </span><br><span class="line">	32768, 98304, 163840, 229376, 294912, 819200, 884736</span><br><span class="line"></span><br><span class="line">Writing inode tables: done                            </span><br><span class="line">Creating journal (32768 blocks): done</span><br><span class="line">Writing superblocks and filesystem accounting information: done</span><br><span class="line"></span><br><span class="line">This filesystem will be automatically checked every 25 mounts or</span><br><span class="line">180 days, whichever comes first.  Use tune2fs -c or -i to override.</span><br></pre></td></tr></table></figure>
</li>
<li><p>通过blkid命令，可以查看硬盘设备的信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@sg-pc /]# blkid</span><br><span class="line">/dev/sda1: UUID=&quot;5e605252-9e26-4ca0-b353-e3e6028bc6ca&quot; TYPE=&quot;ext4&quot; </span><br><span class="line">/dev/sda2: UUID=&quot;drR3Sx-Ht8g-nGFi-2vR3-CD3z-qSjY-PUXiye&quot; TYPE=&quot;LVM2_member&quot; </span><br><span class="line">/dev/mapper/vg_sgpc-lv_root: UUID=&quot;9ccc9289-ada6-48b8-82f1-42d2f7edba06&quot; TYPE=&quot;ext4&quot; </span><br><span class="line">/dev/mapper/vg_sgpc-lv_swap: UUID=&quot;9c4c6c97-b20d-4548-a249-8d98f6b400f1&quot; TYPE=&quot;swap&quot; </span><br><span class="line">/dev/sdb1: LABEL=&quot;backup&quot; UUID=&quot;4a7b5acb-fc24-446d-b9e0-a14afbe171d9&quot; TYPE=&quot;ext4&quot; </span><br><span class="line">/dev/sdb2: LABEL=&quot;myswap&quot; UUID=&quot;79f07b7d-c504-43c2-9e0f-87bee77d59b9&quot; TYPE=&quot;swap&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>将创建完文件系统的分区挂载指定目录下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@sg-pc /]# mkdir /backup</span><br><span class="line">[root@sg-pc /]# mount /dev/sdb1 /backup/</span><br></pre></td></tr></table></figure>
</li>
<li><p>检查分区挂载情况<br><img src="http://oc4wmeyj8.bkt.clouddn.com/%E5%88%86%E5%8C%BA%E6%8C%82%E8%BD%BD%E6%83%85%E5%86%B5.png" alt><br>可以看到/dev/sdb1已经被挂载到/backup目录下了。</p>
</li>
</ul>
<h3 id="交换分区的创建与挂载"><a href="#交换分区的创建与挂载" class="headerlink" title="交换分区的创建与挂载"></a>交换分区的创建与挂载</h3><p>交换分区的创建与挂载步骤与普通分区一致，也是先划分分区，然后在分区上创建文件系统，接着是激活交换分区。因为交换分区与普通分区有一点不同，需要先调整分区的分区ID。</p>
<ul>
<li><p>将/dev/sdb2分区作为交换分区，首先需要修改/dev/sdb2分区的分区ID</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">[root@sg-pc /]# fdisk /dev/sdb</span><br><span class="line"></span><br><span class="line">WARNING: DOS-compatible mode is deprecated. It&apos;s strongly recommended to</span><br><span class="line">         switch off the mode (command &apos;c&apos;) and change display units to</span><br><span class="line">         sectors (command &apos;u&apos;).</span><br><span class="line"></span><br><span class="line">Command (m for help): p</span><br><span class="line"></span><br><span class="line">Disk /dev/sdb: 21.5 GB, 21474836480 bytes</span><br><span class="line">255 heads, 63 sectors/track, 2610 cylinders</span><br><span class="line">Units = cylinders of 16065 * 512 = 8225280 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk identifier: 0x179a39d6</span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sdb1               1         654     5253223+  83  Linux</span><br><span class="line">/dev/sdb2             655        1308     5253255   83  Linux</span><br><span class="line">/dev/sdb3            1309        1962     5253255   83  Linux</span><br><span class="line">/dev/sdb4            1963        2610     5205060    5  Extended</span><br><span class="line">/dev/sdb5            1963        2224     2104483+  83  Linux</span><br><span class="line"></span><br><span class="line">Command (m for help): l</span><br><span class="line"></span><br><span class="line"> 0  Empty           24  NEC DOS         81  Minix / old Lin bf  Solaris        </span><br><span class="line"> 1  FAT12           39  Plan 9          82  Linux swap / So c1  DRDOS/sec (FAT-</span><br><span class="line"> 2  XENIX root      3c  PartitionMagic  83  Linux           c4  DRDOS/sec (FAT-</span><br><span class="line"> 3  XENIX usr       40  Venix 80286     84  OS/2 hidden C:  c6  DRDOS/sec (FAT-</span><br><span class="line"> 4  FAT16 &lt;32M      41  PPC PReP Boot   85  Linux extended  c7  Syrinx         </span><br><span class="line"> 5  Extended        42  SFS             86  NTFS volume set da  Non-FS data    </span><br><span class="line"> 6  FAT16           4d  QNX4.x          87  NTFS volume set db  CP/M / CTOS / .</span><br><span class="line"> 7  HPFS/NTFS       4e  QNX4.x 2nd part 88  Linux plaintext de  Dell Utility   </span><br><span class="line"> 8  AIX             4f  QNX4.x 3rd part 8e  Linux LVM       df  BootIt         </span><br><span class="line"> 9  AIX bootable    50  OnTrack DM      93  Amoeba          e1  DOS access     </span><br><span class="line"> a  OS/2 Boot Manag 51  OnTrack DM6 Aux 94  Amoeba BBT      e3  DOS R/O        </span><br><span class="line"> b  W95 FAT32       52  CP/M            9f  BSD/OS          e4  SpeedStor      </span><br><span class="line"> c  W95 FAT32 (LBA) 53  OnTrack DM6 Aux a0  IBM Thinkpad hi eb  BeOS fs        </span><br><span class="line"> e  W95 FAT16 (LBA) 54  OnTrackDM6      a5  FreeBSD         ee  GPT            </span><br><span class="line"> f  W95 Ext&apos;d (LBA) 55  EZ-Drive        a6  OpenBSD         ef  EFI (FAT-12/16/</span><br><span class="line">10  OPUS            56  Golden Bow      a7  NeXTSTEP        f0  Linux/PA-RISC b</span><br><span class="line">11  Hidden FAT12    5c  Priam Edisk     a8  Darwin UFS      f1  SpeedStor      </span><br><span class="line">12  Compaq diagnost 61  SpeedStor       a9  NetBSD          f4  SpeedStor      </span><br><span class="line">14  Hidden FAT16 &lt;3 63  GNU HURD or Sys ab  Darwin boot     f2  DOS secondary  </span><br><span class="line">16  Hidden FAT16    64  Novell Netware  af  HFS / HFS+      fb  VMware VMFS    </span><br><span class="line">17  Hidden HPFS/NTF 65  Novell Netware  b7  BSDI fs         fc  VMware VMKCORE </span><br><span class="line">18  AST SmartSleep  70  DiskSecure Mult b8  BSDI swap       fd  Linux raid auto</span><br><span class="line">1b  Hidden W95 FAT3 75  PC/IX           bb  Boot Wizard hid fe  LANstep        </span><br><span class="line">1c  Hidden W95 FAT3 80  Old Minix       be  Solaris boot    ff  BBT            </span><br><span class="line">1e  Hidden W95 FAT1</span><br><span class="line"></span><br><span class="line">Command (m for help): t</span><br><span class="line">Partition number (1-5): 2</span><br><span class="line">Hex code (type L to list codes): 82</span><br><span class="line">Changed system type of partition 2 to 82 (Linux swap / Solaris)</span><br><span class="line"></span><br><span class="line">Command (m for help): w</span><br><span class="line">The partition table has been altered!</span><br><span class="line"></span><br><span class="line">Calling ioctl() to re-read partition table.</span><br><span class="line"></span><br><span class="line">WARNING: Re-reading the partition table failed with error 16: Device or resource busy.</span><br><span class="line">The kernel still uses the old table. The new table will be used at</span><br><span class="line">the next reboot or after you run partprobe(8) or kpartx(8)</span><br><span class="line">Syncing disks.</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建交换分区的文件系统</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@sg-pc /]# mkswap -L &apos;myswap&apos; /dev/sdb2</span><br><span class="line">Setting up swapspace version 1, size = 5253248 KiB</span><br><span class="line">LABEL=myswap, UUID=fee42b41-d38f-498e-a27f-70a962734a26</span><br></pre></td></tr></table></figure>
</li>
<li><p>激活交换分区</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@sg-pc /]# free -m</span><br><span class="line">             total       used       free     shared    buffers     cached</span><br><span class="line">Mem:           996        642        354          1        112        304</span><br><span class="line">-/+ buffers/cache:        224        771</span><br><span class="line">Swap:         2015          0       2015</span><br><span class="line">[root@sg-pc /]# swapon -a /dev/sdb2</span><br><span class="line">[root@sg-pc /]# free -m</span><br><span class="line">             total       used       free     shared    buffers     cached</span><br><span class="line">Mem:           996        645        350          1        112        304</span><br><span class="line">-/+ buffers/cache:        228        767</span><br><span class="line">Swap:         7146          0       7146</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="分区开机自动挂载"><a href="#分区开机自动挂载" class="headerlink" title="分区开机自动挂载"></a>分区开机自动挂载</h2><p>上述的硬盘的分区都是在系统中临时挂载使用的，当系统重启的话，目前我们挂载的分区并不会自动挂载上去，又需要我们执行挂载的步骤，这样很不方便。如果我们需要硬盘分区在系统重启的时候也能自动挂载，我们需要将分区的配置写到/etc/fstab这个文件中。<br><img src="http://oc4wmeyj8.bkt.clouddn.com/%E8%87%AA%E5%8A%A8%E6%8C%82%E8%BD%BD1.png" alt><br> /etc/fstab文件中每一行代表一个启动的时候需要自动挂载的硬盘分区。<br>每一行记录友6个字段组成，按照顺序分别为：</p>
<ul>
<li>要挂载的设备</li>
<li>挂载点</li>
<li>文件系统类型</li>
<li>挂载选项<br>一般为defaults</li>
<li>转储频率<br>指的是备份频率，0表示不做备份，1表示每天做备份，2表示隔天做备份</li>
<li>自检次序<br>0表示不自检<br>1表示首先自检，数值越大自检次序越靠后。</li>
</ul>
<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><p>我们以上面划分的./dev/sdb1分区为例，将其设置为每次机器重启的时候都会将/dev/sdb1分区挂载到相应的挂载点。<br><img src="http://oc4wmeyj8.bkt.clouddn.com/%E8%87%AA%E5%8A%A8%E6%8C%82%E8%BD%BD2.png" alt><br> 在/etc/fstab文件中添加如图所示的一行，表示每次机器重启的时候，都会将/dev/sdb1分区挂载到/backup挂载点上，并且该分区的文件系统类型为ext4类型，挂载选项是defautls，不备份，不自检。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>总的来说，Linux下的硬盘分区以及挂载主要是三个步骤：</p>
<ol>
<li>划分分区</li>
<li>创建文件系统</li>
<li>挂载分区<blockquote>
<p>博客地址：<a href="https://win-man.github.io/" target="_blank" rel="noopener">https://win-man.github.io/</a><br>公众号：欢迎关注  </p>
</blockquote>
</li>
</ol>
<p><img src="https://user-gold-cdn.xitu.io/2018/8/16/165435ce71d2b88b?w=258&amp;h=258&amp;f=jpeg&amp;s=26568" alt></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="default">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/07/11/Xtrabackup备份从库的问题/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/pig.jpeg">
      <meta itemprop="name" content="Win-Man">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Win-Man's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/07/11/Xtrabackup备份从库的问题/" class="post-title-link" itemprop="url">Xtrabackup备份从库的问题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-07-11 08:14:05" itemprop="dateCreated datePublished" datetime="2017-07-11T08:14:05+00:00">2017-07-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-02-14 15:12:10" itemprop="dateModified" datetime="2022-02-14T15:12:10+00:00">2022-02-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="环境介绍"><a href="#环境介绍" class="headerlink" title="环境介绍"></a>环境介绍</h2><ul>
<li>数据库信息<br>主库IP：192.168.1.130<br>从库IP：192.168.1.132<br>主库MySQL版本：5.6.36<br>从库MySQL版本：5.6.35</li>
<li>配置信息<br>主从开启GTID复制<br>主库参数配置:gtid-mode=ON;enforce-gtid-consistency=ON<br>从库参数配置:gtid-mode=ON,enforce-gtid-consistency=ON;log-slave-update=ON;master_info_repository=TABLE;relay_log_info_repository=TABLE</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><ul>
<li>搭建主从复制，搭建步骤在此省略</li>
<li><p>使用Xtrabackup备份从库数据</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">备份从库</span><br><span class="line">[root@host-192-168-1-132 backup]# innobackupex --defaults-file=/etc/my.cnf --user=xtrabackup --password=xtrabackup --slave-info --no-timestamp /tmp/backup</span><br><span class="line">应用日志</span><br><span class="line">[root@host-192-168-1-132 backup]# innobackupex --defaults-file=/etc/my.cnf --apply-log /tmp/backup</span><br></pre></td></tr></table></figure>
</li>
<li><p>清空从库数据，并使用备份恢复从库</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@host-192-168-1-132 mysqldata1]# innobackupex --defaults-file=/etc/my.cnf --copy-back /tmp/backup/</span><br><span class="line">[root@host-192-168-1-132 mysqldata1]# chown -R mysql:mysql /home/mysql</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看xtrabckup中备份的slave信息</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@host-192-168-1-132 backup]# cat xtrabackup_slave_info </span><br><span class="line">SET GLOBAL gtid_purged='05dff9fd-5c97-11e7-b3f4-fa163ea44438:1-7';</span><br><span class="line">CHANGE MASTER TO MASTER_AUTO_POSITION=1</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动从库，查看从库信息</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">[root@host-192-168-1-132 mysqldata1]# service mysqld start</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span> show slave status\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: </span><br><span class="line">                  Master_Host: 192.168.1.130</span><br><span class="line">                  Master_User: repl</span><br><span class="line">                  Master_Port: 6306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: mysql-bin.000002</span><br><span class="line">          Read_Master_Log_Pos: 1615</span><br><span class="line">               Relay_Log_File: mysql-relay-bin.000002</span><br><span class="line">                Relay_Log_Pos: 649</span><br><span class="line">        Relay_Master_Log_File: mysql-bin.000002</span><br><span class="line">             Slave_IO_Running: No</span><br><span class="line">            Slave_SQL_Running: No</span><br><span class="line">              Replicate_Do_DB: </span><br><span class="line">          Replicate_Ignore_DB: </span><br><span class="line">           Replicate_Do_Table: </span><br><span class="line">       Replicate_Ignore_Table: </span><br><span class="line">      Replicate_Wild_Do_Table: </span><br><span class="line">  Replicate_Wild_Ignore_Table: </span><br><span class="line">                   Last_Errno: 0</span><br><span class="line">                   Last_Error: </span><br><span class="line">                 Skip_Counter: 0</span><br><span class="line">          Exec_Master_Log_Pos: 1856</span><br><span class="line">              Relay_Log_Space: 0</span><br><span class="line">              Until_Condition: None</span><br><span class="line">               Until_Log_File: </span><br><span class="line">                Until_Log_Pos: 0</span><br><span class="line">           Master_SSL_Allowed: No</span><br><span class="line">           Master_SSL_CA_File: </span><br><span class="line">           Master_SSL_CA_Path: </span><br><span class="line">              Master_SSL_Cert: </span><br><span class="line">            Master_SSL_Cipher: </span><br><span class="line">               Master_SSL_Key: </span><br><span class="line">        Seconds_Behind_Master: NULL</span><br><span class="line">Master_SSL_Verify_Server_Cert: No</span><br><span class="line">                Last_IO_Errno: 0</span><br><span class="line">                Last_IO_Error: </span><br><span class="line">               Last_SQL_Errno: 0</span><br><span class="line">               Last_SQL_Error: </span><br><span class="line">  Replicate_Ignore_Server_Ids: </span><br><span class="line">             Master_Server_Id: 0</span><br><span class="line">                  Master_UUID: 05dff9fd-5c97-11e7-b3f4-fa163ea44438</span><br><span class="line">             Master_Info_File: mysql.slave_master_info</span><br><span class="line">                    SQL_Delay: 0</span><br><span class="line">          SQL_Remaining_Delay: NULL</span><br><span class="line">      Slave_SQL_Running_State: </span><br><span class="line">           Master_Retry_Count: 86400</span><br><span class="line">                  Master_Bind: </span><br><span class="line">      Last_IO_Error_Timestamp: </span><br><span class="line">     Last_SQL_Error_Timestamp: </span><br><span class="line">               Master_SSL_Crl: </span><br><span class="line">           Master_SSL_Crlpath: </span><br><span class="line">           Retrieved_Gtid_Set: </span><br><span class="line">            Executed_Gtid_Set: </span><br><span class="line">                Auto_Position: 1</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span> show master status;</span><br><span class="line">+------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |</span><br><span class="line">+------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">| mysql-bin.000001 |      151 |              |                  |                   |</span><br><span class="line">+------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span> set global gtid_purged='05dff9fd-5c97-11e7-b3f4-fa163ea44438:1-7';</span><br><span class="line">Query OK, 0 rows affected (0.08 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span> start slave;</span><br><span class="line">ERROR 1872 (HY000): Slave failed to initialize relay log info structure from the repository</span><br></pre></td></tr></table></figure>
</li>
<li><p>start slave的时候出现错误，于是重置了slave信息，重新change master 解决问题</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">mysql&gt;</span> reset slave all;</span><br><span class="line">Query OK, 0 rows affected (0.03 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span> change master to</span><br><span class="line">    -&gt; master_host='192.168.1.130',</span><br><span class="line">    -&gt; master_user='repl',</span><br><span class="line">    -&gt; master_password='repl',</span><br><span class="line">    -&gt; master_port=6306,</span><br><span class="line">    -&gt; master_auto_position=1;</span><br><span class="line">Query OK, 0 rows affected, 2 warnings (0.35 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span> start slave;</span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span> show slave status\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting for master to send event</span><br><span class="line">                  Master_Host: 192.168.1.130</span><br><span class="line">                  Master_User: repl</span><br><span class="line">                  Master_Port: 6306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: mysql-bin.000002</span><br><span class="line">          Read_Master_Log_Pos: 1856</span><br><span class="line">               Relay_Log_File: mysql-relay-bin.000002</span><br><span class="line">                Relay_Log_Pos: 408</span><br><span class="line">        Relay_Master_Log_File: mysql-bin.000002</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">              Replicate_Do_DB: </span><br><span class="line">          Replicate_Ignore_DB: </span><br><span class="line">           Replicate_Do_Table: </span><br><span class="line">       Replicate_Ignore_Table: </span><br><span class="line">      Replicate_Wild_Do_Table: </span><br><span class="line">  Replicate_Wild_Ignore_Table: </span><br><span class="line">                   Last_Errno: 0</span><br><span class="line">                   Last_Error: </span><br><span class="line">                 Skip_Counter: 0</span><br><span class="line">          Exec_Master_Log_Pos: 1856</span><br><span class="line">              Relay_Log_Space: 612</span><br><span class="line">              Until_Condition: None</span><br><span class="line">               Until_Log_File: </span><br><span class="line">                Until_Log_Pos: 0</span><br><span class="line">           Master_SSL_Allowed: No</span><br><span class="line">           Master_SSL_CA_File: </span><br><span class="line">           Master_SSL_CA_Path: </span><br><span class="line">              Master_SSL_Cert: </span><br><span class="line">            Master_SSL_Cipher: </span><br><span class="line">               Master_SSL_Key: </span><br><span class="line">        Seconds_Behind_Master: 0</span><br><span class="line">Master_SSL_Verify_Server_Cert: No</span><br><span class="line">                Last_IO_Errno: 0</span><br><span class="line">                Last_IO_Error: </span><br><span class="line">               Last_SQL_Errno: 0</span><br><span class="line">               Last_SQL_Error: </span><br><span class="line">  Replicate_Ignore_Server_Ids: </span><br><span class="line">             Master_Server_Id: 3656</span><br><span class="line">                  Master_UUID: 05dff9fd-5c97-11e7-b3f4-fa163ea44438</span><br><span class="line">             Master_Info_File: mysql.slave_master_info</span><br><span class="line">                    SQL_Delay: 0</span><br><span class="line">          SQL_Remaining_Delay: NULL</span><br><span class="line">      Slave_SQL_Running_State: Slave has read all relay log; waiting for the slave I/O thread to update it</span><br><span class="line">           Master_Retry_Count: 86400</span><br><span class="line">                  Master_Bind: </span><br><span class="line">      Last_IO_Error_Timestamp: </span><br><span class="line">     Last_SQL_Error_Timestamp: </span><br><span class="line">               Master_SSL_Crl: </span><br><span class="line">           Master_SSL_Crlpath: </span><br><span class="line">           Retrieved_Gtid_Set: </span><br><span class="line">            Executed_Gtid_Set: 05dff9fd-5c97-11e7-b3f4-fa163ea44438:1-7</span><br><span class="line">                Auto_Position: 1</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul>
<li>XtraBackup备份从库的时候，利用备份恢复数据之后，第一次启动数据库的时候，不会启动I/O线程和SQL线程</li>
<li>Xtrabackup备份从库，虽然保存了原先slave中chang master to的信息，但是不能直接start slave；需要reset slave all之后重新指定主库信息</li>
<li>Xtrabackup备份从库，不会备份GTID_PURGED的信息，需要恢复的时候，自己指定</li>
</ul>
<blockquote>
<p>博客地址：<a href="https://win-man.github.io/" target="_blank" rel="noopener">https://win-man.github.io/</a><br>公众号：欢迎关注  </p>
</blockquote>
<p><img src="https://user-gold-cdn.xitu.io/2018/8/16/165435ce71d2b88b?w=258&amp;h=258&amp;f=jpeg&amp;s=26568" alt></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="default">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/07/11/两台备库设置server-id一致的问题/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/pig.jpeg">
      <meta itemprop="name" content="Win-Man">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Win-Man's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/07/11/两台备库设置server-id一致的问题/" class="post-title-link" itemprop="url">两台备库设置server_id一致的问题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-07-11 08:13:04" itemprop="dateCreated datePublished" datetime="2017-07-11T08:13:04+00:00">2017-07-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-02-14 15:12:10" itemprop="dateModified" datetime="2022-02-14T15:12:10+00:00">2022-02-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>在《高性能MySQL》上看到说在一主多从的架构中，如果从库的sever_id设置为一样的，可能会导致一些奇怪的现象，例如从库的错误日志中会不断的打印错误日志，会不断的断开连接并重新连接。</p>
<blockquote>
<p>在主库上，会发现两台备库只有一台连接到主库（通常情况下所有的备库都会建立连接等待随时进行复制）。在备库的错误日志中，则会发现反复的重连和连接断开信息，但不会提及被错误配置的服务器ID。</p>
</blockquote>
<p>根据眼见为实，耳听为虚的原则，我搭了一套一主两从的环境，将两台从库的server_id设置为了一样的。但是并没有看到书上提到的现象。考虑了一下，会不会是数据库版本的原因，因为我的测试的数据库版本是5.7.18版本的。于是又重新搭建了一套5.5.36版本的数据库，并成功复现了书上所讲的现象。<br>下面是我的测试步骤。</p>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="环境介绍"><a href="#环境介绍" class="headerlink" title="环境介绍"></a>环境介绍</h3><ul>
<li>主库<br>IP：192.168.1.130<br>server_id：3656</li>
<li>从库A<br>IP：192.168.1.36<br>server_id：56</li>
<li>从库B<br>IP：192.168.1.57<br>server_id：56</li>
</ul>
<p>三台主机除server_id之外，其余配置如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">server_id = 123</span><br><span class="line">[client]</span><br><span class="line">socket = /home/mysql/data/mysqldata5.5/sock/mysql.sock</span><br><span class="line">[mysqld]</span><br><span class="line">#server_id = 3655</span><br><span class="line">server_id = 123</span><br><span class="line">port = 3306</span><br><span class="line">skip_name_resolve = 1</span><br><span class="line">binlog_format = ROW</span><br><span class="line">#binlog_format = STATEMENT</span><br><span class="line">basedir = /home/mysql/program/mysql5.5.36</span><br><span class="line">datadir = /home/mysql/data/mysqldata5.5/mydata</span><br><span class="line">socket = /home/mysql/data/mysqldata5.5/sock/mysql.sock</span><br><span class="line">pid-file = /home/mysql/data/mysqldata5.5/sock/mysql.pid</span><br><span class="line">tmpdir = /home/mysql/data/mysqldata5.5/tmpdir</span><br><span class="line">log-error = /home/mysql/data/mysqldata5.5/log/error.log</span><br><span class="line">slow_query_log</span><br><span class="line">slow_query_log_file = /home/mysql/data/mysqldata5.5/slowlog/slow-query.log</span><br><span class="line">log-bin = /home/mysql/data/mysqldata5.5/binlog/mysql-bin</span><br><span class="line">relay-log = /home/mysql/data/mysqldata5.5/relaylog/mysql-relay-bin</span><br><span class="line">innodb_data_home_dir = /home/mysql/data/mysqldata5.5/innodb_ts</span><br><span class="line">innodb_log_group_home_dir = /home/mysql/data/mysqldata5.5/innodb_log</span><br><span class="line">#innodb_undo_directory = /home/mysql/data/mysqldata5.5/undo/</span><br><span class="line">sync_binlog=1</span><br><span class="line">innodb_file_per_table=1</span><br><span class="line">#skip_grant_tables</span><br><span class="line">expire_logs_days = 1</span><br><span class="line">log_slave_updates = ON</span><br><span class="line">#replicate-same-server-id=1</span><br><span class="line">skip_slave_start</span><br><span class="line">#innodb_undo_tablespaces=1</span><br></pre></td></tr></table></figure></p>
<h3 id="5-5-36版本现象"><a href="#5-5-36版本现象" class="headerlink" title="5.5.36版本现象"></a>5.5.36版本现象</h3><p>初始搭建环境之后，查看各主机状态。搭建环境的步骤就省略。</p>
<h4 id="主库（192-168-1-130）"><a href="#主库（192-168-1-130）" class="headerlink" title="主库（192.168.1.130）"></a>主库（192.168.1.130）</h4><p>主库通过show processlist语句查看，只有一个dump线程，但是通过多次刷新，可以看到连接的是不同的服务器。可以看到每次通过show processlist语句显示的dump线程的Host字段中，IP:PORT的值是不断在更新的，说明dump线程在不断的重连，才会出现占用不同的端口的现象。</p>
<h4 id="从库A（192-168-1-36）"><a href="#从库A（192-168-1-36）" class="headerlink" title="从库A（192.168.1.36）"></a>从库A（192.168.1.36）</h4><p>通过<code>show slave status\G</code>命令查看复制状态，多次执行可以看到<code>Slave_IO_Running</code>字段显示的内容，出现YES或者Connnecting两种状态。可以看到I/O线程在不断的进行重连。<br>并且通过<code>tail -f</code>命令查看error log，可以看到I/O线程一直在尝试重新连接。</p>
<p> 可以看到在错误日志中打印的信息是，I/O线程连接</p>
<h4 id="从库B（192-168-1-57）"><a href="#从库B（192-168-1-57）" class="headerlink" title="从库B（192.168.1.57）"></a>从库B（192.168.1.57）</h4><p>从库B现象与从库A一致。</p>
<h3 id="5-6-36版本现象"><a href="#5-6-36版本现象" class="headerlink" title="5.6.36版本现象"></a>5.6.36版本现象</h3><p>搭建环境步骤省略。</p>
<h4 id="主库（192-168-1-130）-1"><a href="#主库（192-168-1-130）-1" class="headerlink" title="主库（192.168.1.130）"></a>主库（192.168.1.130）</h4><p>show processlist查看有两个dump线程，并且多次刷新，发现Host字段中的IP:PORT并没有修改，说明dump线程一直保持连接。</p>
<h4 id="从库A（192-168-1-36）-1"><a href="#从库A（192-168-1-36）-1" class="headerlink" title="从库A（192.168.1.36）"></a>从库A（192.168.1.36）</h4><p>tail -f /home/mysql/data/mysqldata5.6/log/error.log查看错误日志，没有不断断开连接</p>
<h4 id="从库B（192-168-1-57）-1"><a href="#从库B（192-168-1-57）-1" class="headerlink" title="从库B（192.168.1.57）"></a>从库B（192.168.1.57）</h4><p>tail -f /home/mysql/data/mysqldata5.6/log/error.log查看错误日志，没有不断断开连接</p>
<h2 id="原因分析"><a href="#原因分析" class="headerlink" title="原因分析"></a>原因分析</h2><p><a href="http://www.penglixun.com/tech/database/mysql_multi_slave_same_serverid.html" target="_blank" rel="noopener">http://www.penglixun.com/tech/database/mysql_multi_slave_same_serverid.html</a>这是彭大大写的关于多个slave使用相同server_id时冲突的原因。按照彭大大的分析，我理解的是，slave的I/O线程连接上主库的时候，主库上会调用<code>register_slave()</code>这个函数，在这个函数中又调用了unregister_slave()函数，会将之前使用相同server_id的线程给注销掉。从而导致从库的I/O线程不断断开重连。<br>但是仔细看了一下unregister_slave()函数的代码，并没有发现MySQL是根据server_id来注销dump线程的。并且进一步比较了一下5.5.36和5.6.36版本的代码，并没有发现不同。<br>进一步看了一下彭大大的文章，发现有人在下面评论，说主要是<code>kill_zombie_slave_threads()</code>函数导致的。于是看了一下<code>kill_zombie_slave_threads()</code>函数的逻辑，发现MySQL应该就是在这一步根据server_id将线程kill了。</p>
<ul>
<li><p>5.5.36版本<br>首先来看下5.5.36版本的<code>kill_zombie_dump_threads()</code>函数的代码。看到这个函数传入的参数是一个uint32类型的slave_server_id,在函数中做的事情是，遍历MySQL中的所有线程，如果遍历到一个线程是dump线程并且线程的server_id是等于传入的参数值话，则跳出遍历循环，并对kill掉这个线程。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">void kill_zombie_dump_threads(uint32 slave_server_id)                           </span><br><span class="line">&#123;                                                                               </span><br><span class="line">  mysql_mutex_lock(&amp;LOCK_thread_count);                                         </span><br><span class="line">  I_List_iterator&lt;THD&gt; it(threads);                                             </span><br><span class="line">  THD *tmp;                                                                     </span><br><span class="line">  while ((tmp=it++))                                                            </span><br><span class="line">  &#123;                                                                             </span><br><span class="line">    if (tmp-&gt;command == COM_BINLOG_DUMP &amp;&amp;                                      </span><br><span class="line">      tmp-&gt;server_id == slave_server_id)                                       </span><br><span class="line">    &#123;                                                                           </span><br><span class="line">     mysql_mutex_lock(&amp;tmp-&gt;LOCK_thd_data);    // Lock from delete             </span><br><span class="line">     break;                                                                    </span><br><span class="line">    &#125;                                                                           </span><br><span class="line">  &#125;                                                                             </span><br><span class="line">  mysql_mutex_unlock(&amp;LOCK_thread_count);                                       </span><br><span class="line">  if (tmp)                                                                      </span><br><span class="line">  &#123;                                                                             </span><br><span class="line">    /*                                                                          </span><br><span class="line">     Here we do not call kill_one_thread() as                                  </span><br><span class="line">     it will be slow because it will iterate through the list                  </span><br><span class="line">     again. We just to do kill the thread ourselves.                           </span><br><span class="line">    */                                                                          </span><br><span class="line">    tmp-&gt;awake(THD::KILL_QUERY);                                                </span><br><span class="line">    mysql_mutex_unlock(&amp;tmp-&gt;LOCK_thd_data);                                    </span><br><span class="line">  &#125;                                                                             </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>5.6.35版本<br>再来看一下5.6.36版本的<code>kill_zombie_dump_threads()</code>函数的代码实现，与5.5.36大不相同。首先传入的参数是一THD类型的指针，在函数中实现的逻辑同样是遍历MySQL中的所有线程，如果找到dump线程，首先看一下这个线程有没有uuid字段（因为uuid是在5.6之后的版本才有的，这边是为了兼容5.5），如果有uuid则用uuid进行比较，如果没有uuid，则用server_id进行比较。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"> void kill_zombie_dump_threads(THD *thd)                                                                                                  </span><br><span class="line">&#123;                                                                               </span><br><span class="line">  String slave_uuid;                                                            </span><br><span class="line">  get_slave_uuid(thd, &amp;slave_uuid);                                             </span><br><span class="line">  if (slave_uuid.length() == 0 &amp;&amp; thd-&gt;server_id == 0)                          </span><br><span class="line">    return;                                                                     </span><br><span class="line">                                                                                </span><br><span class="line">  mysql_mutex_lock(&amp;LOCK_thread_count);                                         </span><br><span class="line">  THD *tmp= NULL;                                                               </span><br><span class="line">  Thread_iterator it= global_thread_list_begin();                               </span><br><span class="line">  Thread_iterator end= global_thread_list_end();                                </span><br><span class="line">  bool is_zombie_thread= false;                                                 </span><br><span class="line">  for (; it != end; ++it)                                                       </span><br><span class="line">  &#123;                                                                             </span><br><span class="line">    if ((*it) != thd &amp;&amp; ((*it)-&gt;get_command() == COM_BINLOG_DUMP || (*it)-&gt;get_command() == COM_BINLOG_DUMP_GTID))         </span><br><span class="line">    &#123;                                                                           </span><br><span class="line">     String tmp_uuid;                                                          </span><br><span class="line">     get_slave_uuid((*it), &amp;tmp_uuid);                                         </span><br><span class="line">     if (slave_uuid.length())                                                  </span><br><span class="line">     &#123;                                                                         </span><br><span class="line">       is_zombie_thread= (tmp_uuid.length() &amp;&amp; !strncmp(slave_uuid.c_ptr(),                         </span><br><span class="line">                                         tmp_uuid.c_ptr(), UUID_LENGTH)); </span><br><span class="line">                                                                       </span><br><span class="line">     else                                                                      </span><br><span class="line">     &#123;                                                                         </span><br><span class="line">       /*                                                                      </span><br><span class="line">       ¦ Check if it is a 5.5 slave&apos;s dump thread i.e., server_id should be    </span><br><span class="line">       ¦ same &amp;&amp; dump thread should not contain &apos;UUID&apos;.                        </span><br><span class="line">       */                                                                      </span><br><span class="line">       is_zombie_thread= (((*it)-&gt;server_id == thd-&gt;server_id) &amp;&amp; !tmp_uuid.length());                                 </span><br><span class="line">     &#125;                                                                         </span><br><span class="line">     if (is_zombie_thread)                                                     </span><br><span class="line">     &#123;                                                                         </span><br><span class="line">       tmp= *it;                                                               </span><br><span class="line">       mysql_mutex_lock(&amp;tmp-&gt;LOCK_thd_data);  // Lock from delete             </span><br><span class="line">       break;                                                                  </span><br><span class="line">     &#125;                                                                         </span><br><span class="line">    &#125;                                                                           </span><br><span class="line">  &#125;                                                                             </span><br><span class="line">  mysql_mutex_unlock(&amp;LOCK_thread_count);                                       </span><br><span class="line">  if (tmp)                                                                      </span><br><span class="line">  &#123;                                                                             </span><br><span class="line">    /*                                                                          </span><br><span class="line">    ¦ Here we do not call kill_one_thread() as                                  </span><br><span class="line">    ¦ it will be slow because it will iterate through the list                  </span><br><span class="line">    ¦ again. We just to do kill the thread ourselves.                           </span><br><span class="line">    */                                                                          </span><br><span class="line">    if (log_warnings &gt; 1)                                                       </span><br><span class="line">    &#123;                                                                           </span><br><span class="line">     if (slave_uuid.length())                                                  </span><br><span class="line">     &#123;                                                                       </span><br><span class="line"> sql_print_information(&quot;While initializing dump thread for slave with &quot;  </span><br><span class="line">&quot;UUID &lt;%s&gt;, found a zombie dump thread with the &quot; </span><br><span class="line"> &quot;same UUID. Master is killing the zombie dump &quot;   </span><br><span class="line"> &quot;thread(%lu).&quot;, slave_uuid.c_ptr(),               </span><br><span class="line"> tmp-&gt;thread_id);                                  </span><br><span class="line">     &#125;                                                                         </span><br><span class="line">     else                                                                      </span><br><span class="line">     &#123;                                                                         </span><br><span class="line">       sql_print_information(&quot;While initializing dump thread for slave with &quot;  </span><br><span class="line"> &quot;server_id &lt;%u&gt;, found a zombie dump thread with the &quot;</span><br><span class="line">&quot;same server_id. Master is killing the zombie dump &quot;</span><br><span class="line"> &quot;thread(%lu).&quot;, thd-&gt;server_id,                   </span><br><span class="line"> tmp-&gt;thread_id);                                  </span><br><span class="line">     &#125;                                                                         </span><br><span class="line">    &#125;                                                                           </span><br><span class="line">    tmp-&gt;duplicate_slave_id= true;                                              </span><br><span class="line">    tmp-&gt;awake(THD::KILL_QUERY);                                                </span><br><span class="line">    mysql_mutex_unlock(&amp;tmp-&gt;LOCK_thd_data);                                    </span><br><span class="line">  &#125;                                                                             </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>函数调用<br>知道了<code>kill_zombie_dump_threads()</code>线程实现的逻辑，那MySQL是在什么地方会调用这个函数的呢。看了一下函数是在<code>case COM_BINLOG_DUMP</code>中被调用的。<br>在5.5.36版本中是在</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">case COM_BINLOG_DUMP:                                                         </span><br><span class="line"> &#123;                                                                           </span><br><span class="line"> ulong pos;                                                                </span><br><span class="line"> ushort flags;                                                             </span><br><span class="line"> uint32 slave_server_id;                                                                                                                                 </span><br><span class="line"> status_var_increment(thd-&gt;status_var.com_other);                          </span><br><span class="line"> thd-&gt;enable_slow_log= opt_log_slow_admin_statements;                      </span><br><span class="line"> if (check_global_access(thd, REPL_SLAVE_ACL))                             </span><br><span class="line">break;                                                                                                                                                 </span><br><span class="line"> /* TODO: The following has to be changed to an 8 byte integer */          </span><br><span class="line"> pos = uint4korr(packet);                                                  </span><br><span class="line"> flags = uint2korr(packet + 4);                                            </span><br><span class="line"> thd-&gt;server_id=0; /* avoid suicide */                                     </span><br><span class="line"> if ((slave_server_id= uint4korr(packet+6))) // mysqlbinlog.server_id==0   </span><br><span class="line"> kill_zombie_dump_threads(slave_server_id);                                  </span><br><span class="line"> thd-&gt;server_id = slave_server_id;                                                                                                                    </span><br><span class="line"> general_log_print(thd, command, &quot;Log: &apos;%s&apos;  Pos: %ld&quot;, packet+10,  (long) pos);                                              </span><br><span class="line"> mysql_binlog_send(thd, thd-&gt;strdup(packet + 10), (my_off_t) pos, flags);  </span><br><span class="line">unregister_slave(thd,1,1);                                                </span><br><span class="line">/*  fake COM_QUIT -- if we get here, the thread needs to terminate */     </span><br><span class="line"> error = TRUE;                                                             </span><br><span class="line">break;                                                                    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>在5.6.36版本中也是在<code>case COM_BINLOG_DUMP</code>中，只不过是将之前的逻辑封装在了<code>com_binlog_dump()</code>函数中了，<code>kill_zombie_dump_threads()</code>也是在<code>com_binlog_dump()</code>函数中调用的。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">case COM_BINLOG_DUMP:                                                         </span><br><span class="line">error= com_binlog_dump(thd, packet, packet_length);                                                                                  </span><br><span class="line">break;</span><br></pre></td></tr></table></figure></p>
<p><code>case COM_BINLOG_DUMP</code>中所进行的操作就是将dump线程通知I/O线程拉取新的binlog。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>整理下来的话，基本上可以确定主要是因为<code>kill_zombie_dump_threads()</code>函数导致在5.6之前的版本中，如果是一主多从的架构中，如果在从库之间的server_id如果设置为一样，会出现从开I/O线程不断断开重连的现象。因为在5.6之前的版本中，还没有UUID的概念，MySQL使用server_id来区分是否是同一台机器，而在5.6之后的版本是使用的UUID来区分。<br>总结一句，就是数据库之间的server_id不要设置成一样，不然可能会有一些不可预知的错误。</p>
<blockquote>
<p>博客地址：<a href="https://win-man.github.io/" target="_blank" rel="noopener">https://win-man.github.io/</a><br>公众号：欢迎关注  </p>
</blockquote>
<p><img src="https://user-gold-cdn.xitu.io/2018/8/16/165435ce71d2b88b?w=258&amp;h=258&amp;f=jpeg&amp;s=26568" alt></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="default">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/14/2016总结/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/pig.jpeg">
      <meta itemprop="name" content="Win-Man">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Win-Man's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/01/14/2016总结/" class="post-title-link" itemprop="url">2016总结</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-01-14 10:09:21" itemprop="dateCreated datePublished" datetime="2017-01-14T10:09:21+00:00">2017-01-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-02-14 15:12:10" itemprop="dateModified" datetime="2022-02-14T15:12:10+00:00">2022-02-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/杂/" itemprop="url" rel="index"><span itemprop="name">杂</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>　　其实这篇年终总结早就想写了，可是拖延症犯了，一直拖啊拖啊，已经拖过了 2016 与 2017 年的交界，可是作为一名中国人，我为什么一定要以公历年份来划分我的时间呢，我选择猴年与鸡年来划分我的时间。所以，这篇总结不算晚。</p>
<h2 id="1-回顾"><a href="#1-回顾" class="headerlink" title="1.回顾"></a>1.回顾</h2><h3 id="1-1-实习"><a href="#1-1-实习" class="headerlink" title="1.1 实习"></a>1.1 实习</h3><p>　　过去的一年，由我大三下与大四上组成。从一开始就没有考研的打算，实习便成为了我的一年的主要内容。</p>
<p>　　第一段实习经历是在实验室老师成立的公司，做了一段时间的 Java 开发，之后选择了换一家公司。原因总结来说的话，就是看不到未来，那时候还有一点<strong>技术改变世界</strong>的想法，感觉做出来的产品完全称不上是一个产品，简直就是学校里一个课程设计。老板出去还把这产品吹的天花乱坠的，实际上完全是另一回事。所以果断弃坑。</p>
<p>　　第二段实习经历，主要是为了完成学院的实习要求，还是做 Java 开发。中间过程没有一点可言的。不过也要感谢这段实习经历，让我有时间静下来，学一些东西。也就是在这个期间，我将我的博客从 CSDN 转到了 GitHub，加入了 itsCoder ······ 让我有时间去做我想做的事情了。最后完成学院要求之后，还是毅然决然的离开了，因为不明白，为什么一个成立时间不到两年的一个公司，整天的气氛是死气沉沉的，没有技术氛围。</p>
<p>　　第三段实习经历，就是目前正在经历着的。结束上一段实习经历的时候，我就打算这次好好找一个实习，奔着毕业之后转正的目的找的。投了一波简历，面了一波试。在最后选择了现在的公司，并且完成了转型，从开发转行成为了一名 DBA 。到目前为止，我想我应该是找到了我想要的工作。</p>
<h3 id="1-2-学习"><a href="#1-2-学习" class="headerlink" title="1.2 学习"></a>1.2 学习</h3><p>　　学习这方面的话，整体上进度是不大的。花了前面大半年的时间，都是在学习开发方面的内容，学框架，学技术，学算法，最后怎么也没想到直接从开发转行了，所以学的很多东西对于工作来说，意义不大了。转行 DBA，开始接触数据库开始，才发现原来数据库水这么深，之前理解的数据库就是一个数据的增删改查，之后发现这就是一个新的世界。</p>
<h3 id="1-3-其余"><a href="#1-3-其余" class="headerlink" title="1.3 其余"></a>1.3 其余</h3><p>　　过去的一年，算是崩坏的一年。</p>
<p>　　身体没有好好锻炼，锻炼一段时间歇一段时间的；</p>
<p>　　书没好好读，好多书都是走马观花的浏览了一遍，也没看到心里去；</p>
<p>　　习惯没有好好养成，有很多习惯想要养成，现在看来一个也没成功；</p>
<p>　　计划没有好好执行，计划任然是计划。</p>
<p>　　一年时间，体重飙涨20斤，还好及时发现，狠命锻炼一段时间，减到 70KG ，目前仍维持着。</p>
<p>　　自控力下降，执行力降低。</p>
<p>　　上一张 Github 2016 年的记录，最难做到的还是坚持：</p>
<p><img src="http://oc4wmeyj8.bkt.clouddn.com/github-2016.PNG" alt></p>
<h2 id="2-总结"><a href="#2-总结" class="headerlink" title="2.总结"></a>2.总结</h2><p>　　一句话总结我过去的猴年：<strong>瞎搞</strong>。<br>　　本来一开始想去大公司开始实习的，准备准备，干一波春招。结果被老师打乱了节奏，三段实习经历，公司都不大，但也发现了小公司的好处。自由。不打卡，可以有自己的话语权，公司同事整体年龄比较年轻，有活力。</p>
<p>　　一年下来，没有多少收获，只是找到了之后的职业方向，对自己职业也有了初步的规划。我觉得有这一点也已经够了。</p>
<h2 id="3-计划"><a href="#3-计划" class="headerlink" title="3.计划"></a>3.计划</h2><p>　　又到了制定计划的时候了，把话撂在这，等着明年来打脸（注定的：</p>
<ol>
<li>顺利毕业</li>
<li>读 35 本书，至少完成 20 本书的读书笔记或感想</li>
<li>12 篇认真完成的博客</li>
<li>保证规律的作息时间，不熬夜，11点准时睡觉</li>
<li>锻炼，保证每周至少三次的锻炼</li>
<li>出去走走，一个人也好，两个人也好 </li>
</ol>
<blockquote>
<p>博客地址：<a href="https://win-man.github.io/" target="_blank" rel="noopener">https://win-man.github.io/</a><br>公众号：欢迎关注  </p>
</blockquote>
<p><img src="https://user-gold-cdn.xitu.io/2018/8/16/165435ce71d2b88b?w=258&amp;h=258&amp;f=jpeg&amp;s=26568" alt></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="default">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/31/Linux基础之Tmux使用姿势/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/pig.jpeg">
      <meta itemprop="name" content="Win-Man">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Win-Man's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/12/31/Linux基础之Tmux使用姿势/" class="post-title-link" itemprop="url">Linux基础之Tmux使用姿势</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-12-31 14:15:00" itemprop="dateCreated datePublished" datetime="2016-12-31T14:15:00+00:00">2016-12-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-02-14 15:12:10" itemprop="dateModified" datetime="2022-02-14T15:12:10+00:00">2022-02-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="1-前言"><a href="#1-前言" class="headerlink" title="1. 前言"></a>1. 前言</h2><p>　　之前讲了如何安装 Tmux，这篇文章讲讲如何使用 Tmux。其实工具的使用都是很简单，最终是看你如何使用这个工具，才能发挥出工具最大的作用。</p>
<h2 id="2-基础知识"><a href="#2-基础知识" class="headerlink" title="2. 基础知识"></a>2. 基础知识</h2><p>　　在讲如何使用 Tmux 之前，我们需要先熟悉它的几个概念。</p>
<ul>
<li>会话（Session）</li>
<li>窗口（Window）</li>
<li>面板（Pane）</li>
</ul>
<p><strong>会话：</strong>会话的概念很好理解。我们一台服务器正在那边运行着，我们拿终端工具如：XShell、SecureCRT 等去连接的时候，每新建一个连接，就是一个新的会话。使用 Tmux 新建会话的时候，也是一样，一个新的会话就表示一个新的连接。</p>
<p><strong>窗口：</strong>窗口的概念，可以类比于 Windows 里面的窗口的概念。之前我们连服务器的时候，终端工具每次连接只有一个界面，当我们需要同时操作多个过程的时候，我们就需要建立新的连接。这样很不方便。Tmux 里面的窗口的概念，就可以让我们在一个会话里有多个界面，就不需要去建立的一个会话。</p>
<p><strong>面板：</strong>面板的概念的话，是用于对界面的布局而言的。就是将一个界面划分为多个不同的区域，每个区域我们称之为一个面板。</p>
<p>　　简单来说就是，一个会话里面可以有多个窗口，一个窗口里面可以有多个面板。</p>
<h2 id="3-命令行使用方式"><a href="#3-命令行使用方式" class="headerlink" title="3. 命令行使用方式"></a>3. 命令行使用方式</h2><p>　　Tmux 可以有两种使用方式，一种是命令行的方式，一种是快捷键的方式。前者的话不需要怎么记忆，后者的话效率更高。我觉得还是命令行入门，先熟悉这个工具的作用，之后将常用的几个功能的快捷键记下来，多使用，多熟练。</p>
<h3 id="3-1-会话操作"><a href="#3-1-会话操作" class="headerlink" title="3.1 会话操作"></a>3.1 会话操作</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tmux <span class="keyword">new</span> -s [session_name]  <span class="comment">//  创建一个会话</span></span><br></pre></td></tr></table></figure>
<p>创建完会话之后，会自动进入这个会话之内。并且会话默认帮你创建好一个窗口。<br><img src="http://oc4wmeyj8.bkt.clouddn.com/tmux-1.png" alt></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tmux <span class="built_in">list</span>-sessions <span class="comment">// 显示所有会话，也可以简写成 tmux ls</span></span><br></pre></td></tr></table></figure>
<p><img src="http://oc4wmeyj8.bkt.clouddn.com/tmux-2.png" alt></p>
<p> 当前的话，我一共有一个会话，并且会话的名称为： session1 。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ tmux detach <span class="comment">// 退出当前的会话，返回 shell 界面</span></span><br><span class="line">$ tmux kill-session -t [session_name ] <span class="comment">// 结束一个会话</span></span><br><span class="line">$ tmux attach -t [session_name] <span class="comment">// 回到某一个会话当中</span></span><br><span class="line">$ tmux <span class="keyword">switch</span> -t [session_name] <span class="comment">// 切换到某一会话当中</span></span><br><span class="line">$ tmux kill-server <span class="comment">// 关闭所有会话</span></span><br></pre></td></tr></table></figure>
<h3 id="3-2-窗口操作"><a href="#3-2-窗口操作" class="headerlink" title="3.2 窗口操作"></a>3.2 窗口操作</h3><p>　　讲完会话的操作，我们来讲讲窗口的操作。<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tmux <span class="keyword">new</span>-window [-n window_name] <span class="comment">// 创建一个新的窗口，可以指定新的窗口的名字也可以不指定</span></span><br></pre></td></tr></table></figure></p>
<p><img src="http://oc4wmeyj8.bkt.clouddn.com/tmux-3.png" alt></p>
<p> 这边，我新建了一个名为 window1 的窗口，并且 Tmux 自动帮我切换到了这个窗口，<code>*</code> 标记当前正在使用的窗口，一个窗口默认包含一个面板。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tmux rename-window [new_window_name] <span class="comment">// 重命名当前窗口的名字</span></span><br></pre></td></tr></table></figure>
<p><img src="http://oc4wmeyj8.bkt.clouddn.com/tmux-4.png" alt></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tmux <span class="built_in">list</span>-windows <span class="comment">// 显示当前会话中所有的窗口</span></span><br></pre></td></tr></table></figure>
<p><img src="http://oc4wmeyj8.bkt.clouddn.com/tmux-5.png" alt></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ tmux kill-window -t [window_name | window_index] <span class="comment">// 关闭一个窗口</span></span><br><span class="line">$ tmux select-window -t [window_index] <span class="comment">// 切换窗口</span></span><br></pre></td></tr></table></figure>
<h3 id="3-3-面板操作"><a href="#3-3-面板操作" class="headerlink" title="3.3 面板操作"></a>3.3 面板操作</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ tmux split-window <span class="comment">//将一个面板垂直切成两个面板</span></span><br><span class="line">$ tmux split-window -h <span class="comment">// 将一个面板水平切成两个面板</span></span><br></pre></td></tr></table></figure>
<p><img src="http://oc4wmeyj8.bkt.clouddn.com/tmux-6.png" alt></p>
<p> 可以看到图片中的话，我将一个窗口切成了三部分区域，每一个区域都是一个面板。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ tmux swap-pane -[UDRL] <span class="comment">// 选择 [ 上下左右 ] 的面板交换</span></span><br><span class="line">$ tmux select-pane -[UDRL] <span class="comment">// 选择 [ 上下左右 ] 的面板进行切换</span></span><br></pre></td></tr></table></figure>
<p>　　以上的话就是同过命令行的方式使用 Tmux，使用命令行的方式，可以简单了解一下 Tmux 这个工具提供的一些功能。接下来就是进阶的，使用快捷键的方式操作 Tmux。</p>
<h2 id="4-快捷键使用方式"><a href="#4-快捷键使用方式" class="headerlink" title="4. 快捷键使用方式"></a>4. 快捷键使用方式</h2><p>　　Tmux 快捷键的话需要先按下前缀键，之后再按快捷键才会有效果。 Tmux 默认的前缀键是 <code>Ctrl + b</code>。我就只简单罗列一下快捷键，实际效果的话，使用一下就知道了，上面使用命令行能达到的功能，都能找到相应的快捷键。</p>
<p>　　Tmux 还有一个配置文件，可以根据自己的习惯将快捷键改成自己喜欢的键。</p>
<h3 id="4-1-基本操作"><a href="#4-1-基本操作" class="headerlink" title="4.1 基本操作"></a>4.1 基本操作</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">? 列出所有快捷键；按q返回</span><br><span class="line">d 脱离当前会话,可暂时返回Shell界面</span><br><span class="line">s 选择并切换会话；在同时开启了多个会话时使用</span><br><span class="line">D 选择要脱离的会话；在同时开启了多个会话时使用</span><br><span class="line">: 进入命令行模式；此时可输入支持的命令，例如 kill-server 关闭所有tmux会话</span><br><span class="line">[ 复制模式，光标移动到复制内容位置，空格键开始，方向键选择复制，回车确认，q/Esc退出</span><br><span class="line">] 进入粘贴模式，粘贴之前复制的内容，按q/Esc退出</span><br><span class="line">~ 列出提示信息缓存；其中包含了之前tmux返回的各种提示信息</span><br><span class="line">t 显示当前的时间</span><br><span class="line">ctrl + z 挂起当前会话</span><br></pre></td></tr></table></figure>
<h3 id="4-2-窗口操作"><a href="#4-2-窗口操作" class="headerlink" title="4.2 窗口操作"></a>4.2 窗口操作</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">c 创建新窗口</span><br><span class="line">&amp; 关闭当前窗口</span><br><span class="line">[<span class="number">0</span><span class="number">-9</span>] 数字键切换到指定窗口</span><br><span class="line">p 切换至上一窗口</span><br><span class="line">n 切换至下一窗口</span><br><span class="line">l 前后窗口间互相切换</span><br><span class="line">w 通过窗口列表切换窗口</span><br><span class="line">, 重命名当前窗口，便于识别</span><br><span class="line">. 修改当前窗口编号，相当于重新排序</span><br><span class="line">f 在所有窗口中查找关键词，便于窗口多了切换</span><br></pre></td></tr></table></figure>
<h3 id="4-3-面板操作"><a href="#4-3-面板操作" class="headerlink" title="4.3 面板操作"></a>4.3 面板操作</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">" 将当前面板上下分屏</span></span><br><span class="line"><span class="string">% 将当前面板左右分屏</span></span><br><span class="line"><span class="string">x 关闭当前分屏</span></span><br><span class="line"><span class="string">! 将当前面板置于新窗口,即新建一个窗口,其中仅包含当前面板</span></span><br><span class="line"><span class="string">ctrl+方向键 以1个单元格为单位移动边缘以调整当前面板大小</span></span><br><span class="line"><span class="string">alt+方向键 以5个单元格为单位移动边缘以调整当前面板大小</span></span><br><span class="line"><span class="string">q 显示面板编号</span></span><br><span class="line"><span class="string">o 选择当前窗口中下一个面板</span></span><br><span class="line"><span class="string">方向键 移动光标选择对应面板</span></span><br><span class="line"><span class="string">&#123; 向前置换当前面板</span></span><br><span class="line"><span class="string">&#125; 向后置换当前面板</span></span><br><span class="line"><span class="string">alt+o 逆时针旋转当前窗口的面板</span></span><br><span class="line"><span class="string">ctrl+o 顺时针旋转当前窗口的面板</span></span><br><span class="line"><span class="string">z 最大化当前所在面板</span></span><br><span class="line"><span class="string">page up 向上滚动屏幕，q 退出</span></span><br><span class="line"><span class="string">page down 向下滚动屏幕，q 退出</span></span><br></pre></td></tr></table></figure>
<h2 id="5-总结"><a href="#5-总结" class="headerlink" title="5. 总结"></a>5. 总结</h2><p>　　说到底 Tmux 也就是这么一个工具，功能也就这么多，但是将 Tmux 和 Vim 结合起来的时候，效果就不一样了，在命令行下开发，整个逼格一下就上去了。装逼使人进步。</p>
<blockquote>
<p>博客地址：<a href="https://win-man.github.io/" target="_blank" rel="noopener">https://win-man.github.io/</a><br>公众号：欢迎关注  </p>
</blockquote>
<p><img src="https://user-gold-cdn.xitu.io/2018/8/16/165435ce71d2b88b?w=258&amp;h=258&amp;f=jpeg&amp;s=26568" alt></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="default">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/28/Linux基础之Tmux安装/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/pig.jpeg">
      <meta itemprop="name" content="Win-Man">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Win-Man's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/12/28/Linux基础之Tmux安装/" class="post-title-link" itemprop="url">Linux基础之Tmux安装</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-12-28 20:02:11" itemprop="dateCreated datePublished" datetime="2016-12-28T20:02:11+00:00">2016-12-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-02-14 15:12:10" itemprop="dateModified" datetime="2022-02-14T15:12:10+00:00">2022-02-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="1-前言"><a href="#1-前言" class="headerlink" title="1.前言"></a>1.前言</h2><p>　　Linux 命令行装逼利器——Tmux。转行 DBA 之后整天和命令行打交道，在装逼的道路上越走越远了。Tmux 是 Linux 命令行下一个工具，让我可以更加方便的<strong>装逼</strong>。先讲一下怎么安装这个工具，之后再写一篇文章记录一下怎么使用这个工具。</p>
<p><strong>系统环境：</strong></p>
<blockquote>
<p>CentOS 6.5</p>
</blockquote>
<h2 id="2-安装过程"><a href="#2-安装过程" class="headerlink" title="2.安装过程"></a>2.安装过程</h2><p>　　<code>tmux</code> 工具依赖于 <code>libevent</code> 和 <code>ncurses</code> 两个软件包。我们先安装这两个软件包。</p>
<h3 id="2-1-libevent-安装"><a href="#2-1-libevent-安装" class="headerlink" title="2.1 libevent 安装"></a>2.1 libevent 安装</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 下载 tar.gz 文件  </span></span><br><span class="line"><span class="comment">// 可以在 http://libevent.org/ 网站上找到最新版本</span></span><br><span class="line">$ wget https:<span class="comment">//cloud.github.com/downloads/libevent/libevent/libevent-2.0.21-stable.tar.gz</span></span><br><span class="line"><span class="comment">// 解压 tar.gz 文件</span></span><br><span class="line">$ tar zxvf libevent<span class="number">-2.0</span><span class="number">.21</span>-stable.tar.gz</span><br><span class="line">$ cd libevent<span class="number">-2.0</span><span class="number">.21</span>-stable</span><br><span class="line"><span class="comment">// 配置安装路径并编译安装，这边可能会出现127错误，可以在./configure中加上--without-cxx-binding参数</span></span><br><span class="line">$ ./configure --prefix=/usr/local/libevent</span><br><span class="line">$ make</span><br><span class="line">$ make install</span><br></pre></td></tr></table></figure>
<h3 id="2-2-ncurses-安装"><a href="#2-2-ncurses-安装" class="headerlink" title="2.2 ncurses 安装"></a>2.2 ncurses 安装</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yum install ncurses-devel</span><br></pre></td></tr></table></figure>
<h3 id="2-3-tmux-安装"><a href="#2-3-tmux-安装" class="headerlink" title="2.3 tmux 安装"></a>2.3 tmux 安装</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 下载 tar.gz 文件 在 https://tmux.github.io/ 可以下载到最新版</span></span><br><span class="line">$ wget https:<span class="comment">//github.com/tmux/tmux/releases/download/2.3/tmux-2.3.tar.gz</span></span><br><span class="line"><span class="comment">// 解压 tar.gz 文件</span></span><br><span class="line">$ tar zxvf tmux<span class="number">-2.3</span>.tar.gz </span><br><span class="line">$ cd tmux<span class="number">-2.3</span></span><br><span class="line"><span class="comment">// 配置安装参数并编译安装</span></span><br><span class="line">$ CFLAGS=<span class="string">"-I/usr/local/libevent/include -I/usr/local/ncurses/include"</span> LDFLAGS=<span class="string">"-L/usr/local/libevent/lib -L/usr/local/ncurses/lib"</span> ./configure --prefix=/usr/local/tmux</span><br><span class="line">$ make</span><br><span class="line">$ make install</span><br></pre></td></tr></table></figure>
<h3 id="2-4-配置-PATH-环境变量"><a href="#2-4-配置-PATH-环境变量" class="headerlink" title="2.4 配置 PATH 环境变量"></a>2.4 配置 PATH 环境变量</h3><p>在 /etc/profile 最末尾增加 <code>PATH=$PATH:/usr/local/tmux/bin</code>，并使用 <code>source</code> 命令生效。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将 tmux 拷贝到环境变量目录下</span></span><br><span class="line">$ cp /usr/local/tmux/bin/tmux /usr/local/bin/</span><br></pre></td></tr></table></figure>
<h2 id="3-错误及解决方案"><a href="#3-错误及解决方案" class="headerlink" title="3.错误及解决方案"></a>3.错误及解决方案</h2><h3 id="3-1-问题一"><a href="#3-1-问题一" class="headerlink" title="3.1 问题一"></a>3.1 问题一</h3><p>　　运行 <code>tmux</code> 命令提示 <code>libevent-2.0.so.5</code> 找不到。</p>
<p><img src="http://oc4wmeyj8.bkt.clouddn.com/tmux%E5%AE%89%E8%A3%85%E9%97%AE%E9%A2%981.png" alt></p>
<p>　　<strong>解决方案</strong>：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将 libevent-2.0.so.5 移动到 /usr/lib64 下（64位操作系统） | /usr/lib 下（32位操作系统）</span></span><br><span class="line">$ cp /usr/local/libevent/lib/libevent<span class="number">-2.0</span>.so<span class="number">.5</span> /usr/lib64</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>博客地址：<a href="https://win-man.github.io/" target="_blank" rel="noopener">https://win-man.github.io/</a><br>公众号：欢迎关注  </p>
</blockquote>
<p><img src="https://user-gold-cdn.xitu.io/2018/8/16/165435ce71d2b88b?w=258&amp;h=258&amp;f=jpeg&amp;s=26568" alt></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Win-Man"
      src="/images/pig.jpeg">
  <p class="site-author-name" itemprop="name">Win-Man</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">61</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">13</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">38</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/Win-Man" title="GitHub → https://github.com/Win-Man" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:gang.shen0423@gmail.com" title="E-Mail → mailto:gang.shen0423@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/2855803080" title="Weibo → https://weibo.com/2855803080" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="http://blog.csdn.net/win_man" title="http://blog.csdn.net/win_man" rel="noopener" target="_blank">CSDN博客</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Win-Man</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        


  <div style="display: none;">
    <script src="//s95.cnzz.com/z_stat.php?id=1260159928&web_id=1260159928"></script>
  </div>






      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/muse.js"></script>
<script src="/js/next-boot.js"></script>



  















  

  

</body>
</html>
