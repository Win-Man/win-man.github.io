<!DOCTYPE html>
<html lang="">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="1、概述1.1、目的1.2、环境信息 操作系统版本CentOS Linux release 7.2.1511 (Core) MariaDB:10.1.14-MariaDB MariaDB Server 物理机1：node1：10.10.90.167 物理机2：node2：10.10.90.174 物理机3：node3：10.10.90.181  2、Galera集群搭建步骤2.1、MariaDB安">
<meta name="keywords" content="MariaDB,Galera">
<meta property="og:type" content="article">
<meta property="og:title" content="MariaDB Galera集群搭建">
<meta property="og:url" content="http://yoursite.com/2018/01/15/MariaDB Galera集群搭建/index.html">
<meta property="og:site_name" content="Win-Man&#39;s Blog">
<meta property="og:description" content="1、概述1.1、目的1.2、环境信息 操作系统版本CentOS Linux release 7.2.1511 (Core) MariaDB:10.1.14-MariaDB MariaDB Server 物理机1：node1：10.10.90.167 物理机2：node2：10.10.90.174 物理机3：node3：10.10.90.181  2、Galera集群搭建步骤2.1、MariaDB安">
<meta property="og:locale" content="default">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/8/16/165435ce71d2b88b?w=258&h=258&f=jpeg&s=26568">
<meta property="og:updated_time" content="2022-02-14T15:12:10.110Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="MariaDB Galera集群搭建">
<meta name="twitter:description" content="1、概述1.1、目的1.2、环境信息 操作系统版本CentOS Linux release 7.2.1511 (Core) MariaDB:10.1.14-MariaDB MariaDB Server 物理机1：node1：10.10.90.167 物理机2：node2：10.10.90.174 物理机3：node3：10.10.90.181  2、Galera集群搭建步骤2.1、MariaDB安">
<meta name="twitter:image" content="https://user-gold-cdn.xitu.io/2018/8/16/165435ce71d2b88b?w=258&h=258&f=jpeg&s=26568">

<link rel="canonical" href="http://yoursite.com/2018/01/15/MariaDB Galera集群搭建/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'default'
  };
</script>

  <title>MariaDB Galera集群搭建 | Win-Man's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Win-Man's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="default">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/15/MariaDB Galera集群搭建/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/pig.jpeg">
      <meta itemprop="name" content="Win-Man">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Win-Man's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          MariaDB Galera集群搭建
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-01-15 11:08:13" itemprop="dateCreated datePublished" datetime="2018-01-15T11:08:13+00:00">2018-01-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-02-14 15:12:10" itemprop="dateModified" datetime="2022-02-14T15:12:10+00:00">2022-02-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MariaDB/" itemprop="url" rel="index"><span itemprop="name">MariaDB</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="1、概述"><a href="#1、概述" class="headerlink" title="1、概述"></a>1、概述</h1><h2 id="1-1、目的"><a href="#1-1、目的" class="headerlink" title="1.1、目的"></a>1.1、目的</h2><h2 id="1-2、环境信息"><a href="#1-2、环境信息" class="headerlink" title="1.2、环境信息"></a>1.2、环境信息</h2><ul>
<li>操作系统版本CentOS Linux release 7.2.1511 (Core)</li>
<li>MariaDB:10.1.14-MariaDB MariaDB Server</li>
<li>物理机1：node1：10.10.90.167</li>
<li>物理机2：node2：10.10.90.174</li>
<li>物理机3：node3：10.10.90.181</li>
</ul>
<h1 id="2、Galera集群搭建步骤"><a href="#2、Galera集群搭建步骤" class="headerlink" title="2、Galera集群搭建步骤"></a>2、Galera集群搭建步骤</h1><h2 id="2-1、MariaDB安装步骤"><a href="#2-1、MariaDB安装步骤" class="headerlink" title="2.1、MariaDB安装步骤"></a>2.1、MariaDB安装步骤</h2><h3 id="MariaDB参数"><a href="#MariaDB参数" class="headerlink" title="MariaDB参数"></a>MariaDB参数</h3><p>MariaDB-10.1.14安装步骤与MySQL-5.6一致，只是一些在MySQL中的参数，在MarIaDB中不能使用或者被忽略。在QData的参数模板中，以下参数会导致数据库初始化话<strong>失败</strong>：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">gtid-mode=on # GTID only</span><br><span class="line">enforce-gtid-consistency=true # GTID only</span><br><span class="line">slave_parallel_type=LOGICAL_CLOCK</span><br><span class="line">innodb_undo_log_truncate=ON</span><br><span class="line">log_timestamps=SYSTEM</span><br><span class="line">slave_preserve_commit_order=ON</span><br></pre></td></tr></table></figure></p>
<p>以下参数会使数据库初始化的过程中出现警告:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">slave_pending_jobs_size_max=128M</span><br><span class="line">table_open_cache = 4096</span><br><span class="line">binlog-rows-query-log-events</span><br><span class="line">master-info-repository</span><br><span class="line">relay-log-info-repository</span><br><span class="line">slave-parallel-workers</span><br></pre></td></tr></table></figure></p>
<p>使用的参数模板如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br></pre></td><td class="code"><pre><span class="line">[client]</span><br><span class="line">loose_default-character-set = utf8</span><br><span class="line">port=3306</span><br><span class="line">socket=/home/mysql/data/mysqldata1/sock/mysql.sock</span><br><span class="line">user=admin</span><br><span class="line"></span><br><span class="line">[mysqldump]</span><br><span class="line">quick</span><br><span class="line">max_allowed_packet = 2G</span><br><span class="line">default-character-set = utf8</span><br><span class="line"></span><br><span class="line">[mysql]</span><br><span class="line">no-auto-rehash</span><br><span class="line">show-warnings</span><br><span class="line">prompt=&quot;\\u@\\h : \\d \\r:\\m:\\s&gt; &quot;</span><br><span class="line">default-character-set = utf8</span><br><span class="line"></span><br><span class="line">[myisamchk]</span><br><span class="line">key_buffer = 512M</span><br><span class="line">sort_buffer_size = 512M</span><br><span class="line">read_buffer = 8M</span><br><span class="line">write_buffer = 8M</span><br><span class="line"></span><br><span class="line">[mysqlhotcopy]</span><br><span class="line">interactive-timeout</span><br><span class="line"></span><br><span class="line">[mysqld_safe]</span><br><span class="line">user=mysql</span><br><span class="line">open-files-limit = 65535</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line">#large-pages</span><br><span class="line">#***********************************common parameters******************************</span><br><span class="line">read_only=on</span><br><span class="line">#memlock</span><br><span class="line">default-storage-engine = INNODB</span><br><span class="line">character-set-server=utf8</span><br><span class="line">collation_server = utf8_bin</span><br><span class="line"></span><br><span class="line">user=mysql</span><br><span class="line">port=3306</span><br><span class="line">socket=/home/mysql/data/mysqldata1/sock/mysql.sock</span><br><span class="line">pid-file=/home/mysql/data/mysqldata1/sock/mysql.pid</span><br><span class="line">datadir=/home/mysql/data/mysqldata1/mydata</span><br><span class="line">tmpdir=/home/mysql/data/mysqldata1/tmpdir</span><br><span class="line"></span><br><span class="line">skip-name-resolve</span><br><span class="line">skip_external_locking</span><br><span class="line"></span><br><span class="line">lower_case_table_names=1</span><br><span class="line">event_scheduler=0</span><br><span class="line">back_log=512</span><br><span class="line">default-time-zone=&apos;+8:00&apos;</span><br><span class="line"></span><br><span class="line">max_connections = 3000</span><br><span class="line">max_connect_errors=99999</span><br><span class="line">max_allowed_packet = 64M</span><br><span class="line">#slave_pending_jobs_size_max=128M</span><br><span class="line">max_heap_table_size = 8M</span><br><span class="line">max_length_for_sort_data = 16k</span><br><span class="line"></span><br><span class="line">wait_timeout=172800</span><br><span class="line">interactive_timeout=172800</span><br><span class="line"></span><br><span class="line">net_buffer_length = 8K</span><br><span class="line">read_buffer_size = 2M</span><br><span class="line">read_rnd_buffer_size = 2M</span><br><span class="line">sort_buffer_size = 2M</span><br><span class="line">join_buffer_size = 4M</span><br><span class="line">binlog_cache_size = 2M</span><br><span class="line"></span><br><span class="line">#table_open_cache = 4096</span><br><span class="line">table_open_cache_instances = 2</span><br><span class="line">table_definition_cache = 4096</span><br><span class="line">thread_cache_size = 512</span><br><span class="line">tmp_table_size = 8M</span><br><span class="line"></span><br><span class="line">query_cache_size=0</span><br><span class="line">query_cache_type=OFF</span><br><span class="line">explicit_defaults_for_timestamp=ON</span><br><span class="line"></span><br><span class="line">#*******************************  Logs related settings ***************************</span><br><span class="line">log-error=/home/mysql/data/mysqldata1/log/error.log</span><br><span class="line">long_query_time = 1</span><br><span class="line">slow_query_log</span><br><span class="line">slow_query_log_file=/home/mysql/data/mysqldata1/slowlog/slow-query.log</span><br><span class="line">log_slow_slave_statements</span><br><span class="line">#log_queries_not_using_indexes</span><br><span class="line"></span><br><span class="line">#*******************************  Replication related settings **********************</span><br><span class="line"></span><br><span class="line">#### For Master</span><br><span class="line">server-id=3306191</span><br><span class="line">log-bin=/home/mysql/data/mysqldata1/binlog/mysql-bin</span><br><span class="line">binlog-format=ROW</span><br><span class="line">binlog-checksum=CRC32</span><br><span class="line">#binlog-rows-query-log-events=1</span><br><span class="line">max_binlog_size = 512M</span><br><span class="line">expire_logs_days=15</span><br><span class="line">sync_binlog=1</span><br><span class="line">master-verify-checksum=1</span><br><span class="line">#master-info-repository=TABLE</span><br><span class="line">auto_increment_increment=2</span><br><span class="line">auto_increment_offset=2</span><br><span class="line"></span><br><span class="line">#### For Slave</span><br><span class="line">relay-log=/home/mysql/data/mysqldata1/relaylog/mysql-relay-bin</span><br><span class="line">#relay-log-info-repository=TABLE</span><br><span class="line">relay-log-recovery=1</span><br><span class="line">#slave-skip-errors=1022,1032,1062,1236</span><br><span class="line">slave-sql-verify-checksum=1</span><br><span class="line">log_bin_trust_function_creators=1</span><br><span class="line">log_slave_updates=1</span><br><span class="line">slave-net-timeout=10</span><br><span class="line">skip-slave-start</span><br><span class="line"></span><br><span class="line">#******************************* MyISAM Specific options ****************************</span><br><span class="line">key_buffer_size = 8M</span><br><span class="line">bulk_insert_buffer_size = 8M</span><br><span class="line">myisam_sort_buffer_size = 64M</span><br><span class="line">myisam_max_sort_file_size = 10G</span><br><span class="line">myisam_repair_threads = 1</span><br><span class="line">myisam_recover_options=force</span><br><span class="line"></span><br><span class="line"># ***************************** INNODB Specific options ****************************</span><br><span class="line">#### Data options</span><br><span class="line">#innodb_data_home_dir = /home/mysql/data/mysqldata1/innodb_ts</span><br><span class="line">innodb_data_file_path = ibdata1:2048M:autoextend</span><br><span class="line">innodb_file_per_table</span><br><span class="line">innodb_file_format = barracuda</span><br><span class="line">innodb_file_format_max = barracuda</span><br><span class="line">innodb_file_format_check = ON</span><br><span class="line">innodb_strict_mode = 1</span><br><span class="line">innodb_flush_method = O_DIRECT</span><br><span class="line">innodb_checksum_algorithm=crc32</span><br><span class="line">innodb_autoinc_lock_mode=2</span><br><span class="line"></span><br><span class="line">#### Buffer Pool options</span><br><span class="line">innodb_buffer_pool_size = 4G</span><br><span class="line">innodb_buffer_pool_instances = 2</span><br><span class="line">innodb_max_dirty_pages_pct = 75</span><br><span class="line">innodb_adaptive_flushing = ON</span><br><span class="line">innodb_flush_neighbors = 0</span><br><span class="line">innodb_lru_scan_depth = 4096</span><br><span class="line">#innodb_change_buffering = inserts</span><br><span class="line">innodb_old_blocks_time = 1000</span><br><span class="line"></span><br><span class="line">#### Redo options</span><br><span class="line">innodb_log_group_home_dir = /home/mysql/data/mysqldata1/innodb_log</span><br><span class="line">innodb_log_buffer_size = 64M</span><br><span class="line">innodb_log_file_size = 2G</span><br><span class="line">innodb_log_files_in_group = 2</span><br><span class="line">innodb_flush_log_at_trx_commit = 1</span><br><span class="line">innodb_fast_shutdown = 2</span><br><span class="line">innodb_support_xa = ON</span><br><span class="line"></span><br><span class="line">#### Transaction options</span><br><span class="line">innodb_thread_concurrency = 64</span><br><span class="line">innodb_lock_wait_timeout = 120</span><br><span class="line">innodb_rollback_on_timeout = 1</span><br><span class="line">transaction_isolation = READ-COMMITTED</span><br><span class="line"></span><br><span class="line">#### IO options</span><br><span class="line">innodb_read_io_threads = 8</span><br><span class="line">innodb_write_io_threads = 16</span><br><span class="line">innodb_io_capacity = 20000</span><br><span class="line">innodb_use_native_aio = 1</span><br><span class="line"></span><br><span class="line">#### Undo options</span><br><span class="line">innodb_undo_directory = /home/mysql/data/mysqldata1/undo/</span><br><span class="line">innodb_undo_tablespaces=16</span><br><span class="line">innodb_purge_threads = 4</span><br><span class="line">innodb_purge_batch_size = 512</span><br><span class="line">innodb_max_purge_lag = 65536</span><br><span class="line"></span><br><span class="line">#### 5.6/5.7 GTID</span><br><span class="line">#gtid-mode=on # GTID only</span><br><span class="line">#enforce-gtid-consistency=true # GTID only</span><br><span class="line"></span><br><span class="line">#### mysql 5.7</span><br><span class="line">#super_read_only=on</span><br><span class="line">secure_file_priv=/data2/</span><br><span class="line">#slave_parallel_workers=16</span><br><span class="line">#slave_parallel_type=LOGICAL_CLOCK</span><br><span class="line">#innodb_undo_log_truncate=ON</span><br><span class="line">#log_timestamps=SYSTEM</span><br><span class="line">#slave_preserve_commit_order=ON</span><br><span class="line"></span><br><span class="line">#### mariadb</span><br><span class="line">gtid_strict_mode=on</span><br><span class="line">gtid_domain_id=191</span><br><span class="line"></span><br><span class="line">#### galera</span><br><span class="line">wsrep_on=on</span><br><span class="line">wsrep_provider=/usr/local/mysql/lib/galera/libgalera_smm.so</span><br><span class="line">wsrep_provider_options=&quot;gcache.size=1G&quot;</span><br><span class="line"></span><br><span class="line">wsrep_cluster_name=wqglr_0001</span><br><span class="line">wsrep_cluster_address=gcomm://10.10.90.167:4567,10.10.90.174:4567,10.10.90.181:4567</span><br><span class="line">wsrep_node_name = node3</span><br><span class="line">wsrep_node_address=10.10.90.181:4567</span><br><span class="line">#</span><br><span class="line">#wsrep_sst_method=xtrabackup-v2</span><br><span class="line">#wsrep_sst_auth=&quot;xtrabackup:xtrabackuppass&quot;</span><br><span class="line">#wsrep_slave_threads=16</span><br><span class="line">#</span><br><span class="line">#innodb_support_xa = OFF</span><br><span class="line">#sync_binlog=0</span><br><span class="line">#innodb_flush_log_at_trx_commit = 0</span><br></pre></td></tr></table></figure></p>
<h3 id="安装步骤"><a href="#安装步骤" class="headerlink" title="安装步骤"></a>安装步骤</h3><ul>
<li><p>创建目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /data2/mysqldata1/&#123;binlog,conf,innodb_log,innodb_ts,log,mydata,relaylog,slowlog,sock,tmpdir,undo&#125;</span><br><span class="line">mkdir -p /home/mysql/&#123;data,program&#125;</span><br><span class="line">ln -s /data2/mysqldata1 /home/mysql/data/mysqldata1</span><br></pre></td></tr></table></figure>
</li>
<li><p>下载二进制安装包，并上传到对应位置</p>
</li>
<li><p>将安装包解压至指定目录,并建立软链至/usr/local</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf mariadb-10.1.14-linux-x86_64 -c /home/mysql/program/</span><br><span class="line">ln -s /home/mysql/program/mariadb-10.1.14-linux-x86_64 /usr/local/mysql</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加用户以及用户组</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">groupadd mysql</span><br><span class="line">useradd -r -g mysql mysql</span><br></pre></td></tr></table></figure>
</li>
<li><p>更改目录权限</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chown -R mysql:mysql /data/mysqldata1</span><br></pre></td></tr></table></figure>
</li>
<li><p>填写配置文件<br>将上面的配置文件内容写到/etc/my.cnf中</p>
</li>
<li>初始化数据库<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/mysql</span><br><span class="line">./scripts/mysql_install_db --defaults-file=/etc/my.cnf --user=mysql</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>验证安装成功：</strong><br>查看是否有两个OK</p>
<ul>
<li><p>添加service启动方式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/local/mysql/support-files/mysql.server /etc/init.d/mysqld</span><br></pre></td></tr></table></figure>
</li>
<li><p>尝试启动数据库，验证数据库正常</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service mysqld start</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong> 按照相同的步骤安装三个节点</strong></p>
<h2 id="2-2、Galera集群安装步骤"><a href="#2-2、Galera集群安装步骤" class="headerlink" title="2.2、Galera集群安装步骤"></a>2.2、Galera集群安装步骤</h2><h3 id="2-2-1、第一个节点安装"><a href="#2-2-1、第一个节点安装" class="headerlink" title="2.2.1、第一个节点安装"></a>2.2.1、第一个节点安装</h3><p>安装步骤:</p>
<ul>
<li><p>在配置文件中填写galera集群的配置参数<br>一下为最基础的参数配置，一些调优等的配置参数不列在这边</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">gtid_strict_mode=on</span><br><span class="line">gtid_domain_id=191</span><br><span class="line">wsrep_on=on</span><br><span class="line">wsrep_provider=/usr/local/mysql/lib/galera/libgalera_smm.so</span><br><span class="line">wsrep_provider_options=&quot;gcache.size=1G&quot;</span><br><span class="line">wsrep_cluster_name=wqglr_0001</span><br><span class="line">wsrep_cluster_address=gcomm://10.10.90.167:4567,10.10.90.174:4567,10.10.90.181:4567</span><br><span class="line">wsrep_node_name = node3</span><br><span class="line">wsrep_node_address=10.10.90.181:4567</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动第一个节点<br>galera集群启动第一个节点的时候需要加上，–wsrep-new-cluster来初始化一个集群，这个只需要在<strong>第一个节点第一次启动</strong>的时候添加，之后该节点启动时不需要添加该参数，因为这个参数的表示初始化一个新的集群，每次添加该参数，都会初始化一个新的集群</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/mysql/bin</span><br><span class="line">./mysqld_safe --defaults-file=/etc/my.cnf --wsrep-new-cluster &amp;</span><br></pre></td></tr></table></figure>
</li>
<li><p>进入数据库检查，集群状态 show status like ‘%wsrep_%’</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">root@localhost : (none) 11:00:08&gt; show status like &apos;%wsrep_%&apos;;</span><br><span class="line">+------------------------------+----------------------------------------------------------------+</span><br><span class="line">| Variable_name                | Value                                                          |</span><br><span class="line">+------------------------------+----------------------------------------------------------------+</span><br><span class="line">| wsrep_apply_oooe            | 0.000000                                                      |</span><br><span class="line">| wsrep_apply_oool            | 0.000000                                                      |</span><br><span class="line">| wsrep_apply_window          | 1.000000                                                      |</span><br><span class="line">| wsrep_causal_reads          | 0                                                              |</span><br><span class="line">| wsrep_cert_deps_distance    | 1.000000                                                      |</span><br><span class="line">| wsrep_cert_index_size        | 1                                                              |</span><br><span class="line">| wsrep_cert_interval          | 0.000000                                                      |</span><br><span class="line">| wsrep_cluster_conf_id        | 10                                                            |</span><br><span class="line">| wsrep_cluster_size          | 3                                                              |</span><br><span class="line">| wsrep_cluster_state_uuid    | 5ace7bde-f5d3-11e7-81fd-b7f62639a9a0                          |</span><br><span class="line">| wsrep_cluster_status        | Primary                                                        |</span><br><span class="line">| wsrep_commit_oooe            | 0.000000                                                      |</span><br><span class="line">| wsrep_commit_oool            | 0.000000                                                      |</span><br><span class="line">| wsrep_commit_window          | 1.000000                                                      |</span><br><span class="line">| wsrep_connected              | ON                                                            |</span><br><span class="line">| wsrep_evs_delayed            | 829f35c1-f5d6-11e7-9525-b21c1d0f3f09:tcp://10.10.90.191:4567:1 |</span><br><span class="line">| wsrep_evs_evict_list        |                                                                |</span><br><span class="line">| wsrep_evs_repl_latency      | 0/0/0/0/0                                                      |</span><br><span class="line">| wsrep_evs_state              | OPERATIONAL                                                    |</span><br><span class="line">| wsrep_flow_control_paused    | 0.000000                                                      |</span><br><span class="line">| wsrep_flow_control_paused_ns | 0                                                              |</span><br><span class="line">| wsrep_flow_control_recv      | 0                                                              |</span><br><span class="line">| wsrep_flow_control_sent      | 0                                                              |</span><br><span class="line">| wsrep_gcomm_uuid            | 5acdf3cc-f5d3-11e7-bcb5-46c7c07b299e                          |</span><br><span class="line">| wsrep_incoming_addresses    | 10.10.90.181:3306,10.10.90.167:3306,10.10.90.174:3306          |</span><br><span class="line">| wsrep_last_committed        | 3                                                              |</span><br><span class="line">| wsrep_local_bf_aborts        | 0                                                              |</span><br><span class="line">| wsrep_local_cached_downto    | 1                                                              |</span><br><span class="line">| wsrep_local_cert_failures    | 0                                                              |</span><br><span class="line">| wsrep_local_commits          | 0                                                              |</span><br><span class="line">| wsrep_local_index            | 1                                                              |</span><br><span class="line">| wsrep_local_recv_queue      | 0                                                              |</span><br><span class="line">| wsrep_local_recv_queue_avg  | 0.074074                                                      |</span><br><span class="line">| wsrep_local_recv_queue_max  | 2                                                              |</span><br><span class="line">| wsrep_local_recv_queue_min  | 0                                                              |</span><br><span class="line">| wsrep_local_replays          | 0                                                              |</span><br><span class="line">| wsrep_local_send_queue      | 0                                                              |</span><br><span class="line">| wsrep_local_send_queue_avg  | 0.000000                                                      |</span><br><span class="line">| wsrep_local_send_queue_max  | 1                                                              |</span><br><span class="line">| wsrep_local_send_queue_min  | 0                                                              |</span><br><span class="line">| wsrep_local_state            | 4                                                              |</span><br><span class="line">| wsrep_local_state_comment    | Synced                                                        |</span><br><span class="line">| wsrep_local_state_uuid      | 5ace7bde-f5d3-11e7-81fd-b7f62639a9a0                          |</span><br><span class="line">| wsrep_protocol_version      | 7                                                              |</span><br><span class="line">| wsrep_provider_name          | Galera                                                        |</span><br><span class="line">| wsrep_provider_vendor        | Codership Oy &lt;info@codership.com&gt;                              |</span><br><span class="line">| wsrep_provider_version      | 25.3.15(r3578)                                                |</span><br><span class="line">| wsrep_ready                  | ON                                                            |</span><br><span class="line">| wsrep_received              | 27                                                            |</span><br><span class="line">| wsrep_received_bytes        | 3661                                                          |</span><br><span class="line">| wsrep_repl_data_bytes        | 356                                                            |</span><br><span class="line">| wsrep_repl_keys              | 1                                                              |</span><br><span class="line">| wsrep_repl_keys_bytes        | 31                                                            |</span><br><span class="line">| wsrep_repl_other_bytes      | 0                                                              |</span><br><span class="line">| wsrep_replicated            | 1                                                              |</span><br><span class="line">| wsrep_replicated_bytes      | 451                                                            |</span><br><span class="line">| wsrep_thread_count          | 2                                                              |</span><br><span class="line">+------------------------------+----------------------------------------------------------------+</span><br><span class="line">57 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>重点关注几个状态:<br><code>wsrep_connected=on</code> 表示链接已开启<br><code>wsrep_local_index=1</code> 表示集群中的索引值<br><code>wsrep_cluster_size=3</code> 表示集群中节点的数量<br><code>wsrep_incoming_addresses =0.10.90.181:3306,10.10.90.167:3306,10.10.90.174:3306</code>集群中节点的访问地址</p>
<h3 id="2-2-2、加入一个数据节点"><a href="#2-2-2、加入一个数据节点" class="headerlink" title="2.2.2、加入一个数据节点"></a>2.2.2、加入一个数据节点</h3><p>安装步骤</p>
<ul>
<li><p>在配置文件中填写galera集群的配置参数<br>一下为最基础的参数配置，一些调优等的配置参数不列在这边</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">gtid_strict_mode=on</span><br><span class="line">gtid_domain_id=191</span><br><span class="line">wsrep_on=on</span><br><span class="line">wsrep_provider=/usr/local/mysql/lib/galera/libgalera_smm.so</span><br><span class="line">wsrep_provider_options=&quot;gcache.size=1G&quot;</span><br><span class="line">wsrep_cluster_name=wqglr_0001</span><br><span class="line">wsrep_cluster_address=gcomm://10.10.90.167:4567,10.10.90.174:4567,10.10.90.181:4567</span><br><span class="line">wsrep_node_name = node3</span><br><span class="line">wsrep_node_address=10.10.90.181:4567</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动节点</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service mysqld start</span><br></pre></td></tr></table></figure>
</li>
<li><p>进入数据库检查，集群状态 show status like ‘%wsrep_%’</p>
</li>
</ul>
<h3 id="2-2-3、加入一个仲裁节点"><a href="#2-2-3、加入一个仲裁节点" class="headerlink" title="2.2.3、加入一个仲裁节点"></a>2.2.3、加入一个仲裁节点</h3><p>仲裁节点不需要初始化数据库，不需要进行配置，但是数据目录需要创建，数据库程序需要部署</p>
<ul>
<li><p>启动仲裁节点</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/mysql/bin</span><br><span class="line">./garbd --address=&quot;gcomm://10.10.90.167:4567,10.10.90.174:4567,10.10.90.181:4567&quot; --group=wqglr_0001 --name=&apos;10.10.90.181:4567&apos; --log=/home/mysql/data/mysqldata1/log/garbd.log -d</span><br></pre></td></tr></table></figure>
</li>
<li><p>检查仲裁节点加入情况<br>node1或者node2上show status like ‘%wsrep_cluster%’;查看集群节点数量，发现集群节点数量增加1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@localhost : (none) 01:23:30&gt; show status like &apos;%wsrep_cluster%&apos;;</span><br><span class="line">+--------------------------+--------------------------------------+</span><br><span class="line">| Variable_name            | Value                                |</span><br><span class="line">+--------------------------+--------------------------------------+</span><br><span class="line">| wsrep_cluster_conf_id    | 3                                    |</span><br><span class="line">| wsrep_cluster_size      | 3                                    |</span><br><span class="line">| wsrep_cluster_state_uuid | 75b1d970-f681-11e7-a221-af292503fa6e |</span><br><span class="line">| wsrep_cluster_status    | Primary                              |</span><br><span class="line">+--------------------------+--------------------------------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="2-2-4、验证数据同步"><a href="#2-2-4、验证数据同步" class="headerlink" title="2.2.4、验证数据同步"></a>2.2.4、验证数据同步</h3><p>在node1上：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create database test1;</span><br><span class="line">use test1;</span><br><span class="line">create table test1(id int primary key auto_increment,name varchar(20));</span><br><span class="line">insert  into test1(`name`) values(&apos;test1&apos;);</span><br></pre></td></tr></table></figure></p>
<p>在node2上<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create database test2;</span><br><span class="line">use test2;</span><br><span class="line">create table test1(id int primary key auto_increment,name varchar(20));</span><br><span class="line">insert  into test1(`name`) values(&apos;test1&apos;);</span><br></pre></td></tr></table></figure></p>
<p>在两个节点上查询数据，发现数据复制正常</p>
<h3 id="2-2-5、脑裂验证"><a href="#2-2-5、脑裂验证" class="headerlink" title="2.2.5、脑裂验证"></a>2.2.5、脑裂验证</h3><h1 id="3、安装过程中的问题"><a href="#3、安装过程中的问题" class="headerlink" title="3、安装过程中的问题"></a>3、安装过程中的问题</h1><h2 id="galera集群启动过程中，报libssl和libcrypto库缺失"><a href="#galera集群启动过程中，报libssl和libcrypto库缺失" class="headerlink" title="galera集群启动过程中，报libssl和libcrypto库缺失"></a>galera集群启动过程中，报libssl和libcrypto库缺失</h2><p>错误日志：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">2018-01-09 16:19:28 140122035881856 [Warning] &apos;table-open-cache-instances&apos; is MySQL 5.6 compatible option. Not used or needed in MariaDB.</span><br><span class="line">2018-01-09 16:19:28 140122035881856 [Note] /usr/local/mysql/bin/mysqld (mysqld 10.1.14-MariaDB) starting as process 31625 ...</span><br><span class="line">2018-01-09 16:19:28 140122035881856 [Note] WSREP: Read nil XID from storage engines, skipping position init</span><br><span class="line">2018-01-09 16:19:28 140122035881856 [Note] WSREP: wsrep_load(): loading provider library &apos;/usr/local/mysql/lib/galera/libgalera_smm.so&apos;</span><br><span class="line">2018-01-09 16:19:28 140122035881856 [ERROR] WSREP: wsrep_load(): dlopen(): libssl.so.6: cannot open shared object file: No such file or directory</span><br><span class="line">2018-01-09 16:19:28 140122035881856 [ERROR] WSREP: wsrep_load(/usr/local/mysql/lib/galera/libgalera_smm.so) failed: Invalid argument (22). Reverting to no provider.</span><br><span class="line">2018-01-09 16:19:28 140122035881856 [Note] WSREP: Read nil XID from storage engines, skipping position init</span><br><span class="line">2018-01-09 16:19:28 140122035881856 [Note] WSREP: wsrep_load(): loading provider library &apos;none&apos;</span><br><span class="line">2018-01-09 16:19:28 140122035881856 [ERROR] Aborting</span><br></pre></td></tr></table></figure></p>
<p>解决方案：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">#ldd libgalera_smm.so</span><br><span class="line">        linux-vdso.so.1 =&gt;  (0x00007ffda1bdc000)</span><br><span class="line">        libpthread.so.0 =&gt; /lib64/libpthread.so.0 (0x00007fabbb35f000)</span><br><span class="line">        librt.so.1 =&gt; /lib64/librt.so.1 (0x00007fabbb157000)</span><br><span class="line">        libssl.so.6 =&gt; not found</span><br><span class="line">        libcrypto.so.6 =&gt; not found</span><br><span class="line">        libstdc++.so.6 =&gt; /lib64/libstdc++.so.6 (0x00007fabbae4e000)</span><br><span class="line">        libm.so.6 =&gt; /lib64/libm.so.6 (0x00007fabbab4b000)</span><br><span class="line">        libgcc_s.so.1 =&gt; /lib64/libgcc_s.so.1 (0x00007fabba935000)</span><br><span class="line">        libc.so.6 =&gt; /lib64/libc.so.6 (0x00007fabba574000)</span><br><span class="line">        /lib64/ld-linux-x86-64.so.2 (0x00007fabbbade000)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@node2 /lib64]</span><br><span class="line">#cd /usr/lib64</span><br><span class="line"></span><br><span class="line">[root@node2 /usr/lib64]</span><br><span class="line">#ll libssl*</span><br><span class="line">-rwxr-xr-x. 1 root 272536 Nov 20  2015 libssl3.so</span><br><span class="line">lrwxrwxrwx. 1 root    16 Dec 27 15:31 libssl.so -&gt; libssl.so.1.0.1e</span><br><span class="line">lrwxrwxrwx. 1 root    16 Dec 27 15:30 libssl.so.10 -&gt; libssl.so.1.0.1e</span><br><span class="line">-rwxr-xr-x. 1 root 449864 Jun 29  2015 libssl.so.1.0.1e</span><br><span class="line"></span><br><span class="line">[root@node2 /usr/lib64]</span><br><span class="line">#ln -s libssl.so.1.0.1e libssl.so.6</span><br><span class="line"></span><br><span class="line">[root@node2 /usr/lib64]</span><br><span class="line">#ll libcrypto*</span><br><span class="line">lrwxrwxrwx. 1 root      19 Dec 27 15:31 libcrypto.so -&gt; libcrypto.so.1.0.1e</span><br><span class="line">lrwxrwxrwx. 1 root      19 Dec 27 15:30 libcrypto.so.10 -&gt; libcrypto.so.1.0.1e</span><br><span class="line">-rwxr-xr-x. 1 root 2012880 Jun 29  2015 libcrypto.so.1.0.1e</span><br><span class="line"></span><br><span class="line">[root@node2 /usr/lib64]</span><br><span class="line">#ln -s libcrypto.so.1.0.1e libcrypto.so.6</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#ldd /usr/local/mysql/lib/galera/libgalera_smm.so</span><br><span class="line">        linux-vdso.so.1 =&gt;  (0x00007ffecdbad000)</span><br><span class="line">        libpthread.so.0 =&gt; /lib64/libpthread.so.0 (0x00007fe44169e000)</span><br><span class="line">        librt.so.1 =&gt; /lib64/librt.so.1 (0x00007fe441496000)</span><br><span class="line">        libssl.so.6 =&gt; /lib64/libssl.so.6 (0x00007fe441228000)</span><br><span class="line">        libcrypto.so.6 =&gt; /lib64/libcrypto.so.6 (0x00007fe440e41000)</span><br><span class="line">        libstdc++.so.6 =&gt; /lib64/libstdc++.so.6 (0x00007fe440b39000)</span><br><span class="line">        libm.so.6 =&gt; /lib64/libm.so.6 (0x00007fe440836000)</span><br><span class="line">        libgcc_s.so.1 =&gt; /lib64/libgcc_s.so.1 (0x00007fe440620000)</span><br><span class="line">        libc.so.6 =&gt; /lib64/libc.so.6 (0x00007fe44025f000)</span><br><span class="line">        /lib64/ld-linux-x86-64.so.2 (0x00007fe441e1d000)</span><br><span class="line">        libgssapi_krb5.so.2 =&gt; /lib64/libgssapi_krb5.so.2 (0x00007fe440012000)</span><br><span class="line">        libkrb5.so.3 =&gt; /lib64/libkrb5.so.3 (0x00007fe43fd2d000)</span><br><span class="line">        libcom_err.so.2 =&gt; /lib64/libcom_err.so.2 (0x00007fe43fb29000)</span><br><span class="line">        libk5crypto.so.3 =&gt; /lib64/libk5crypto.so.3 (0x00007fe43f8f6000)</span><br><span class="line">        libdl.so.2 =&gt; /lib64/libdl.so.2 (0x00007fe43f6f2000)</span><br><span class="line">        libz.so.1 =&gt; /lib64/libz.so.1 (0x00007fe43f4dc000)</span><br><span class="line">        libkrb5support.so.0 =&gt; /lib64/libkrb5support.so.0 (0x00007fe43f2cc000)</span><br><span class="line">        libkeyutils.so.1 =&gt; /lib64/libkeyutils.so.1 (0x00007fe43f0c8000)</span><br><span class="line">        libresolv.so.2 =&gt; /lib64/libresolv.so.2 (0x00007fe43eeae000)</span><br><span class="line">        libselinux.so.1 =&gt; /lib64/libselinux.so.1 (0x00007fe43ec88000)</span><br><span class="line">        libpcre.so.1 =&gt; /lib64/libpcre.so.1 (0x00007fe43ea27000)</span><br><span class="line">        liblzma.so.5 =&gt; /lib64/liblzma.so.5 (0x00007fe43e802000)</span><br></pre></td></tr></table></figure></p>
<h2 id="配置的innodb-data-home-dir和innodb-log-home-dir，导致rsync模式的sst传输报错"><a href="#配置的innodb-data-home-dir和innodb-log-home-dir，导致rsync模式的sst传输报错" class="headerlink" title="配置的innodb_data_home_dir和innodb_log_home_dir，导致rsync模式的sst传输报错"></a>配置的innodb_data_home_dir和innodb_log_home_dir，导致rsync模式的sst传输报错</h2><p>因为我们的galera集群的配置参数中没有指定：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#wsrep_sst_method=xtrabackup-v2</span><br><span class="line">#wsrep_sst_auth=&quot;xtrabackup:xtrabackuppass&quot;</span><br></pre></td></tr></table></figure></p>
<p>所以galeta集群在进行sst的时候是通过默认的的rsync方式同步的，但是在这种方式下，不能自定义innodb_data_home_dir和innodb_log_home_dir,这是MariaDB Galera的BUG，如果要自定义这两个参数，可以选择xtrabackup的方式。<br>wsrep_sst_method可以指定为mysqldump,xtrabackup,rsync三种，xtrabackup的方式锁表时间最短</p>
<blockquote>
<p>博客地址：<a href="https://win-man.github.io/" target="_blank" rel="noopener">https://win-man.github.io/</a><br>公众号：欢迎关注  </p>
</blockquote>
<p><img src="https://user-gold-cdn.xitu.io/2018/8/16/165435ce71d2b88b?w=258&amp;h=258&amp;f=jpeg&amp;s=26568" alt></p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/MariaDB/" rel="tag"># MariaDB</a>
              <a href="/tags/Galera/" rel="tag"># Galera</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2017/09/19/MySQL——触发器、存储过程、函数、定时器认识/" rel="prev" title="MySQL——触发器、存储过程、函数、定时器认识">
      <i class="fa fa-chevron-left"></i> MySQL——触发器、存储过程、函数、定时器认识
    </a></div>
      <div class="post-nav-item">
    <a href="/2018/01/29/《Docker从入门到实践》笔记思维导图/" rel="next" title="《Docker从入门到实践》笔记思维导图">
      《Docker从入门到实践》笔记思维导图 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1、概述"><span class="nav-number">1.</span> <span class="nav-text">1、概述</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1、目的"><span class="nav-number">1.1.</span> <span class="nav-text">1.1、目的</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2、环境信息"><span class="nav-number">1.2.</span> <span class="nav-text">1.2、环境信息</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2、Galera集群搭建步骤"><span class="nav-number">2.</span> <span class="nav-text">2、Galera集群搭建步骤</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1、MariaDB安装步骤"><span class="nav-number">2.1.</span> <span class="nav-text">2.1、MariaDB安装步骤</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#MariaDB参数"><span class="nav-number">2.1.1.</span> <span class="nav-text">MariaDB参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安装步骤"><span class="nav-number">2.1.2.</span> <span class="nav-text">安装步骤</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2、Galera集群安装步骤"><span class="nav-number">2.2.</span> <span class="nav-text">2.2、Galera集群安装步骤</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-1、第一个节点安装"><span class="nav-number">2.2.1.</span> <span class="nav-text">2.2.1、第一个节点安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-2、加入一个数据节点"><span class="nav-number">2.2.2.</span> <span class="nav-text">2.2.2、加入一个数据节点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-3、加入一个仲裁节点"><span class="nav-number">2.2.3.</span> <span class="nav-text">2.2.3、加入一个仲裁节点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-4、验证数据同步"><span class="nav-number">2.2.4.</span> <span class="nav-text">2.2.4、验证数据同步</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-5、脑裂验证"><span class="nav-number">2.2.5.</span> <span class="nav-text">2.2.5、脑裂验证</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3、安装过程中的问题"><span class="nav-number">3.</span> <span class="nav-text">3、安装过程中的问题</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#galera集群启动过程中，报libssl和libcrypto库缺失"><span class="nav-number">3.1.</span> <span class="nav-text">galera集群启动过程中，报libssl和libcrypto库缺失</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置的innodb-data-home-dir和innodb-log-home-dir，导致rsync模式的sst传输报错"><span class="nav-number">3.2.</span> <span class="nav-text">配置的innodb_data_home_dir和innodb_log_home_dir，导致rsync模式的sst传输报错</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Win-Man"
      src="/images/pig.jpeg">
  <p class="site-author-name" itemprop="name">Win-Man</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">61</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">13</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">38</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/Win-Man" title="GitHub → https://github.com/Win-Man" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:gang.shen0423@gmail.com" title="E-Mail → mailto:gang.shen0423@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/2855803080" title="Weibo → https://weibo.com/2855803080" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="http://blog.csdn.net/win_man" title="http://blog.csdn.net/win_man" rel="noopener" target="_blank">CSDN博客</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Win-Man</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        


  <div style="display: none;">
    <script src="//s95.cnzz.com/z_stat.php?id=1260159928&web_id=1260159928"></script>
  </div>






      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/muse.js"></script>
<script src="/js/next-boot.js"></script>



  















  

  

</body>
</html>
